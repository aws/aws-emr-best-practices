<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-bestpractices/Features/Managed Scaling/troubleshooting" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">Troubleshooting | AWS Open Data Analytics</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://aws.github.io/aws-emr-best-practices/img/AWS_logo_RGB.png"><meta data-rh="true" name="twitter:image" content="https://aws.github.io/aws-emr-best-practices/img/AWS_logo_RGB.png"><meta data-rh="true" property="og:url" content="https://aws.github.io/aws-emr-best-practices/docs/bestpractices/Features/Managed Scaling/troubleshooting"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Troubleshooting | AWS Open Data Analytics"><meta data-rh="true" name="description" content="Overview"><meta data-rh="true" property="og:description" content="Overview"><link data-rh="true" rel="icon" href="/aws-emr-best-practices/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://aws.github.io/aws-emr-best-practices/docs/bestpractices/Features/Managed Scaling/troubleshooting"><link data-rh="true" rel="alternate" href="https://aws.github.io/aws-emr-best-practices/docs/bestpractices/Features/Managed Scaling/troubleshooting" hreflang="en"><link data-rh="true" rel="alternate" href="https://aws.github.io/aws-emr-best-practices/docs/bestpractices/Features/Managed Scaling/troubleshooting" hreflang="x-default"><link rel="stylesheet" href="/aws-emr-best-practices/assets/css/styles.28ef5182.css">
<script src="/aws-emr-best-practices/assets/js/runtime~main.cb172d24.js" defer="defer"></script>
<script src="/aws-emr-best-practices/assets/js/main.dca7638f.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/aws-emr-best-practices/"><div class="navbar__logo"><img src="/aws-emr-best-practices/img/logo.svg" alt="AWS Open Data Analytics" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/aws-emr-best-practices/img/logo.svg" alt="AWS Open Data Analytics" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">AWS Open Data Analytics</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/aws-emr-best-practices/docs/bestpractices/">Best Practices</a><a class="navbar__item navbar__link" href="/aws-emr-best-practices/docs/benchmarks/introduction">Benchmarks</a><a class="navbar__item navbar__link" href="/aws-emr-best-practices/docs/utilities/">Utilities</a><a class="navbar__item navbar__link" href="/aws-emr-best-practices/docs/migration/introduction">Migration</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/aws-emr-best-practices/docs/bestpractices/">EMR Best Practices Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/aws-emr-best-practices/docs/bestpractices/Cost Optimizations/Introduction">Cost Optimizations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/aws-emr-best-practices/docs/bestpractices/Reliability/introduction">Reliability</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/aws-emr-best-practices/docs/bestpractices/Security/introduction">Security</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/aws-emr-best-practices/docs/bestpractices/Features/EMRFS/best_practices">Features</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/aws-emr-best-practices/docs/bestpractices/Features/EMRFS/best_practices">EMRFS</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/aws-emr-best-practices/docs/bestpractices/Features/Managed Scaling/best_practices">Managed Scaling</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/aws-emr-best-practices/docs/bestpractices/Features/Managed Scaling/best_practices">Best Practices</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/aws-emr-best-practices/docs/bestpractices/Features/Managed Scaling/troubleshooting">Troubleshooting</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/aws-emr-best-practices/docs/bestpractices/Features/Spot Usage/best_practices">Spot Usage</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/aws-emr-best-practices/docs/bestpractices/Applications/Hadoop/introduction">Applications</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/aws-emr-best-practices/docs/bestpractices/Architecture/Adhoc/introduction">Architecture</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/aws-emr-best-practices/docs/bestpractices/Observability/best_practices">Observability</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/aws-emr-best-practices/docs/bestpractices/Troubleshooting/Troubleshooting EMR">Troubleshooting</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/aws-emr-best-practices/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Features</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Managed Scaling</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Troubleshooting</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Troubleshooting</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h2>
<p>This guide provides a systematic approach to troubleshooting EMR Managed Scaling. It aims to help customers independently validate scaling behaviors, identify issues, and resolve common problems. The runbook covers various scaling scenarios including scale up, scale down, slow scaling, no scaling, and stuck scaling events. By following the supplied steps, customers can gain better insight into EMR cluster management related to managed scaling, and optimize their deployments more effectively. When additional assistance is needed, the guide also outlines how to efficiently engage AWS Support.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="required-access-to-troubleshoot">Required Access to Troubleshoot<a href="#required-access-to-troubleshoot" class="hash-link" aria-label="Direct link to Required Access to Troubleshoot" title="Direct link to Required Access to Troubleshoot">​</a></h2>
<ul>
<li>An EMR cluster with <a href="https://docs.aws.amazon.com/emr/latest/ManagementGuide/emr-managed-scaling.html" target="_blank" rel="noopener noreferrer">Managed Scaling</a> enabled.</li>
<li>IAM permissions to access all necessary resources, including Amazon S3 buckets for logs, CloudWatch metrics, and SSH access to the EMR cluster nodes if required.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="feature-history-best-practices-and-considerations">Feature History, Best Practices and Considerations<a href="#feature-history-best-practices-and-considerations" class="hash-link" aria-label="Direct link to Feature History, Best Practices and Considerations" title="Direct link to Feature History, Best Practices and Considerations">​</a></h2>
<p>This section provides insights for EMR managed scaling users, covering three key areas for optimizing cluster performance, cost-efficiency, and adaptability</p>
<ol>
<li><a href="https://docs.aws.amazon.com/emr/latest/ManagementGuide/emr-managed-scaling.html#emr-managed-scaling-history" target="_blank" rel="noopener noreferrer">Feature History</a>: Consult this when you need to understand recent updates and enhancements to the EMR managed scaling capability. It&#x27;s particularly useful if you&#x27;re interested in new features like node labels or availability in new AWS Regions.</li>
<li><a href="https://docs.aws.amazon.com/emr/latest/ManagementGuide/emr-managed-scaling.html#emr-managed-scaling-considerations" target="_blank" rel="noopener noreferrer">Considerations</a>: Review these points before implementing managed scaling. The link covers regional availability, required parameters, connectivity requirements for the metrics-collector process, and potential adjustments for YARN jobs during scale-down.</li>
<li><a href="https://aws.github.io/aws-emr-best-practices/docs/bestpractices/Features/Managed%20Scaling/best_practices/" target="_blank" rel="noopener noreferrer">Best Practices</a>: Reference these guidelines when planning your EMR cluster setup. It focuses on strategies like keeping core nodes constant and scaling with only task nodes to improve scaling times and performance.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="understanding-node-allocation-strategies">Understanding Node Allocation Strategies<a href="#understanding-node-allocation-strategies" class="hash-link" aria-label="Direct link to Understanding Node Allocation Strategies" title="Direct link to Understanding Node Allocation Strategies">​</a></h2>
<p>This summary of the <a href="https://docs.aws.amazon.com/emr/latest/ManagementGuide/managed-scaling-allocation-strategy.html" target="_blank" rel="noopener noreferrer">AWS node allocation strategy article</a> provides an overview of scaling strategies used by Managed Scaling across EMR release labels. For detailed information, please refer to the full article.&quot;</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="scale-up-strategy">Scale-up Strategy<a href="#scale-up-strategy" class="hash-link" aria-label="Direct link to Scale-up Strategy" title="Direct link to Scale-up Strategy">​</a></h4>
<p>For EMR releases 7.2 and higher, managed scaling first considers node labels and application process restrictions.
If node labels are enabled, scaling behavior differs based on restrictions (e.g., CORE nodes, ON_DEMAND nodes).
Without node labels, application processes aren&#x27;t restricted to specific node or market types.
EMR considers MaximumCoreCapacityUnits and MaximumOnDemandCapacityUnits when scaling, prioritizing based on these limits.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="scale-down-strategy">Scale-down Strategy<a href="#scale-down-strategy" class="hash-link" aria-label="Direct link to Scale-down Strategy" title="Direct link to Scale-down Strategy">​</a></h4>
<p>Removes nodes based on node labels if enabled.
Without node labels, removes task nodes first, then core nodes, respecting minimum capacity limits.
For EMR versions 5.34.0+ and 6.4.0+, scaling is aware of Spark shuffle data to prevent unintended data loss.
Avoids scaling down nodes running Spark ApplicationMaster to minimize job failures and retries.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="key-considerations">Key Considerations<a href="#key-considerations" class="hash-link" aria-label="Direct link to Key Considerations" title="Direct link to Key Considerations">​</a></h4>
<p>Use On-Demand for core nodes to avoid HDFS data loss from Spot reclamation.
Consider using Spot for task nodes to reduce costs and improve job execution speed.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="common-scaling-scenarios">Common Scaling Scenarios<a href="#common-scaling-scenarios" class="hash-link" aria-label="Direct link to Common Scaling Scenarios" title="Direct link to Common Scaling Scenarios">​</a></h3>
<p><strong>Scale Core Nodes Only</strong>
Set On-Demand limit and maximum core node equal to the maximum boundary.</p>
<p><strong>Scale Task Nodes Only</strong>
Set maximum core node equal to the minimum boundary.</p>
<p><strong>On-Demand Instances Only</strong>
Set On-Demand limit equal to the maximum boundary.</p>
<p><strong>Spot Instances Only</strong>
Set On-Demand limit to 0.</p>
<p><strong>On-Demand on Core, Spot on Task</strong>:
Set On-Demand limit equal to maximum core node, both less than maximum boundary.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="graphing-metrics-related-to-managed-scaling">Graphing Metrics Related to Managed Scaling<a href="#graphing-metrics-related-to-managed-scaling" class="hash-link" aria-label="Direct link to Graphing Metrics Related to Managed Scaling" title="Direct link to Graphing Metrics Related to Managed Scaling">​</a></h2>
<p>The troubleshooting portion of this runbook frequently requests that Cloudwatch metrics be analyzed. It is highly beneficial to have a consistent view of Yarn metrics related to EMR clusters when Managed Scaling enabled so the resource utilization can be examined. Please review <a href="https://docs.aws.amazon.com/emr/latest/ManagementGuide/managed-scaling-metrics.html#managed-scaling-graphic" target="_blank" rel="noopener noreferrer">Graphing Managed Scaling Metrics</a> for more information on setting up views.
<img decoding="async" loading="lazy" src="/aws-emr-best-practices/assets/images/ms-metrics-0a2d1a685cd8cd05945adface5beda0d.png" width="2000" height="1125" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="validating-and-actioning-scaling-events">Validating and Actioning Scaling Events<a href="#validating-and-actioning-scaling-events" class="hash-link" aria-label="Direct link to Validating and Actioning Scaling Events" title="Direct link to Validating and Actioning Scaling Events">​</a></h2>
<p><strong>Summary</strong>: The following section outlines possible managed scaling actions, and includes the resource to check to validate whether the event took place. Note that not all <strong>validate</strong> locations need to be checked. Multiple points are referenced for comprehensiveness.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="scale-up">SCALE UP<a href="#scale-up" class="hash-link" aria-label="Direct link to SCALE UP" title="Direct link to SCALE UP">​</a></h3>
<ul>
<li>
<p><strong>Definition</strong>: Core or Task Instances are added to the EMR Cluster when no additional compute resource is required.</p>
</li>
<li>
<p><strong>Symptoms</strong>:  The EMR Cluster scales up, resulting in excess compute capacity. During scale-up events, CloudWatch metrics show high <a href="https://docs.aws.amazon.com/emr/latest/ManagementGuide/UsingEMR_ViewingMetrics.html#UsingEMR_ViewingMetrics_Access" target="_blank" rel="noopener noreferrer">YARNMemoryAvailablePercentage</a> and low or zero <a href="https://docs.aws.amazon.com/emr/latest/ManagementGuide/UsingEMR_ViewingMetrics.html#UsingEMR_ViewingMetrics_Access" target="_blank" rel="noopener noreferrer">ContainerPending</a>. This indicates that the cluster had sufficient available resources and no pending workload requiring additional capacity.</p>
</li>
<li>
<p><strong>Potential Root Cause/s</strong>:</p>
<ul>
<li>Managed scaling triggered a scale-up based on resource utilization metrics</li>
<li>A scale-up event was initiated outside of managed scaling</li>
<li>The minimum cluster size configuration was increased by a user in the managed scaling configurations</li>
</ul>
</li>
<li>
<p><strong>Validate</strong>:</p>
<ul>
<li>The <a href="https://docs.aws.amazon.com/emr/latest/ManagementGuide/UsingEMR_ViewingMetrics.html#UsingEMR_ViewingMetrics_Access" target="_blank" rel="noopener noreferrer">TotalNodesRequested</a> and <a href="https://docs.aws.amazon.com/emr/latest/ManagementGuide/UsingEMR_ViewingMetrics.html#UsingEMR_ViewingMetrics_Access" target="_blank" rel="noopener noreferrer">TotalNodesRunning</a> metrics in CloudWatch, these will reflect a request for new nodes, and an increase in total running nodes.</li>
<li>Review <code>/var/log/hadoop-yarn/hadoop-yarn-resourcemanager-*.log</code> from the leader node. Log line will look like <code>Added node ip-address.region.compute.internal:8041 clusterResource:resources</code></li>
<li>Review the EMR Cluster page in AWS Console for another view of Cloudwatch metrics<!-- -->
<ul>
<li><em>EMR Cluster → Monitoring Tab → Node Status</em></li>
</ul>
</li>
<li>Review the Events Tab in EMR Cluster for written description of event<!-- -->
<ul>
<li><em>EMR Cluster → Events Tab → Search for String ‘ Instance Group State Change’</em></li>
</ul>
</li>
<li>Whether <a href="https://docs.aws.amazon.com/emr/latest/ManagementGuide/UsingEMR_ViewingMetrics.html#UsingEMR_ViewingMetrics_MetricsReported" target="_blank" rel="noopener noreferrer">YARNMemoryAvailablePercentage</a> has decreased, we expect to see low memory availability at time of scale up.</li>
</ul>
</li>
<li>
<p><strong>Actions</strong>:</p>
<ul>
<li>Check whether the <a href="https://docs.aws.amazon.com/emr/latest/ManagementGuide/emr-managed-scaling.html#emr-managed-scaling-parameters" target="_blank" rel="noopener noreferrer">MinimumCapacityUnits/Instances</a> were increased by a user, resulting in a scale up irrelevant of low resource utilization.</li>
<li>Determine if a manual resize was triggered on the EMR Cluster through a user triggered call to resize instance fleet or group.</li>
</ul>
</li>
<li>
<p><strong>Related Links</strong>:</p>
<ul>
<li><a href="https://docs.aws.amazon.com/emr/latest/ManagementGuide/managed-scaling-metrics.html" target="_blank" rel="noopener noreferrer">Managed Scaling Metrics</a></li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="scale-down">SCALE DOWN<a href="#scale-down" class="hash-link" aria-label="Direct link to SCALE DOWN" title="Direct link to SCALE DOWN">​</a></h3>
<ul>
<li><strong>Definition</strong>: Core and/or Task Instances are removed from the EMR Cluster when the use-case required the scaled-down instances.</li>
<li><strong>Symptoms</strong>: Scale down occurs, leading to insufficient resources in the EMR Cluster to handle incoming applications.</li>
<li><strong>Potential Root Cause/s</strong>:<!-- -->
<ul>
<li>EMR Managed Scaling triggered a scale down event based on threshold limits.</li>
<li>A scale down event was triggered outside of managed scaling</li>
<li>The maximum cluster node count was reduced in the managed scaling configuration</li>
</ul>
</li>
<li><strong>Validate</strong>:<!-- -->
<ul>
<li>The TotalNodesRunning metric in CloudWatch, this will reflect a decrease in the running node count on scale down.</li>
<li>Review <code>/var/log/hadoop-yarn/hadoop-yarn-resourcemanager-*.log</code> from the leader node. Log line will look like <code>Removed node ip-address.region.compute.internal:8041 clusterResource: resources</code></li>
<li>Review EMR Cluster page in AWS Console for another view of Cloudwatch metrics<!-- -->
<ul>
<li><em>EMR Cluster → Monitoring Tab → Node Status</em></li>
</ul>
</li>
<li>Review the Events Tab in EMR Cluster for written description of event<!-- -->
<ul>
<li><em>EMR Cluster → Events Tab → Search for String ‘ Instance Group State Change’</em></li>
</ul>
</li>
</ul>
</li>
<li><strong>Actions</strong>:<!-- -->
<ul>
<li>Monitor <a href="https://docs.aws.amazon.com/emr/latest/ManagementGuide/UsingEMR_ViewingMetrics.html" target="_blank" rel="noopener noreferrer">YARNMemoryAvailablePercentage</a> during scale-down. To prevent unwanted scaling, ensure clusters remain adequately utilized.</li>
<li>If frequent scale-downs lead to delays due to subsequent time to scale-up, consider a higher <a href="https://docs.aws.amazon.com/emr/latest/ManagementGuide/emr-managed-scaling.html#emr-managed-scaling-parameters" target="_blank" rel="noopener noreferrer">Minimum Capacity</a> configuration. This may increase costs but can help mitigate delays where spikey workloads lead to time delays scaling up after scale down.</li>
<li>Where possible, orchestrate incoming work to minimize scaling altogether, while scaling is useful to adjust to resources to match incoming workload, minimizing scaling events will decrease the time associated with provision and decommissioning instances.</li>
</ul>
</li>
<li><strong>Related Links</strong>:<!-- -->
<ul>
<li><a href="https://aws.github.io/aws-emr-best-practices/docs/bestpractices/Features/Managed%20Scaling/best_practices/" target="_blank" rel="noopener noreferrer">Managed Scaling Best Practices</a></li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="slow-scaling">SLOW SCALING<a href="#slow-scaling" class="hash-link" aria-label="Direct link to SLOW SCALING" title="Direct link to SLOW SCALING">​</a></h3>
<ul>
<li><strong>Definition</strong>: The EMR cluster is taking a long time to resize an instance group</li>
<li><strong>Symptoms</strong>: Long scale-up or scale-down times, leading to delayed processing or inefficient use of resources. Applications may be waiting longer than expected for additional capacity.</li>
<li><strong>Potential Root Cause/s</strong>:<!-- -->
<ul>
<li><strong>When scaling down</strong>: Managed Scaling is attempted gracefully, this means that on scale down, the Yarn NodeManager needs to enter a decommissioning state to ensure that containers are not launched on the node. In addition to this, in the event the node is a Core node, to prevent data loss and under-replication, HDFS blocks are migrated to an existing healthy node. Slowdown can occur when there is a large volume of data to transfer to a healthy node, or if running containers delay full decommissioning.</li>
<li><strong>When scaling up</strong>: When using Spot instances, EMR provides a configurable timeout. Delay in scaling can occur if Spot instances are unavailable at the time and of request.</li>
<li><strong>Bootstrap actions</strong>: Where possible, avoid long running bootstrap actions, these run when instances are provisioned, and increase the time taken for instances to enter a ready state where they can accept work.</li>
</ul>
</li>
<li><strong>Validate</strong>:<!-- -->
<ul>
<li>Review <a href="https://docs.aws.amazon.com/emr/latest/ManagementGuide/UsingEMR_ViewingMetrics.html#UsingEMR_ViewingMetrics_MetricsReported" target="_blank" rel="noopener noreferrer">TotalNodesRequested</a> and <a href="https://docs.aws.amazon.com/emr/latest/ManagementGuide/UsingEMR_ViewingMetrics.html#UsingEMR_ViewingMetrics_MetricsReported" target="_blank" rel="noopener noreferrer">TotalNodesRunning</a> metrics in CloudWatch. TotalNodesRequested  should take longer to reach TotalNodesRunning than is acceptable based on your use-case.</li>
</ul>
</li>
<li><strong>Actions</strong>:<!-- -->
<ul>
<li>Ensure <a href="https://docs.aws.amazon.com/emr/latest/ManagementGuide/emr-manage-view-web-log-files.html" target="_blank" rel="noopener noreferrer">bootstrap actions</a> complete quickly, consider moving less critical bootstrap functions that aren’t required to run at startup to a framework that runs after EMR node initialization such as Steps or custom scripts.</li>
<li>If using Spot Instances, ensure on-demand capacity is sufficient to handle running application in the event that no spot capacity is available.</li>
<li>Where possible scale task nodes. This can be done by setting on-demand nodes and Core nodes to the same value, and scaling spot task nodes. This will remove the need to migrate HDFS blocks to other nodes, significantly improving scale down times.</li>
<li>To optimize resource usage during decommissioning, you can reduce the <code>spark.blacklist.decommissioning.timeout</code> from one hour to one minute to make the node available sooner for other pending containers, while also increasing the <code>yarn.resourcemanager.nodemanager-graceful-decommission-timeout-secs</code> to a larger value (default 1 hour), to give the nodes more runway for graceful decommissioning. This configuration enables containers to run on the decommissioning node, but there is a trade-off that applications may fail if there are running containers on the node and the <code>yarn.resourcemanager.nodemanager-graceful-decommission-timeout-secs</code> is exceeded.</li>
</ul>
</li>
<li><strong>Related Links</strong>:<!-- -->
<ul>
<li><a href="https://docs.aws.amazon.com/emr/latest/ManagementGuide/emr-work-with-steps.html" target="_blank" rel="noopener noreferrer">EMR Steps</a></li>
<li><a href="https://docs.aws.amazon.com/emr/latest/ManagementGuide/emr-manage-view-web-log-files.html" target="_blank" rel="noopener noreferrer">Finding Common EMR Log Files</a></li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="no-scaling">NO SCALING<a href="#no-scaling" class="hash-link" aria-label="Direct link to NO SCALING" title="Direct link to NO SCALING">​</a></h3>
<ul>
<li><strong>Definition</strong>: The EMR cluster is not scaling and applications are waiting for resources</li>
<li><strong>Symptoms</strong>: The <a href="https://docs.aws.amazon.com/emr/latest/ManagementGuide/UsingEMR_ViewingMetrics.html#UsingEMR_ViewingMetrics_MetricsReported" target="_blank" rel="noopener noreferrer">TotalNodesRequested</a> metric in CloudWatch remains unchanged, and applications either await resources (no scale-up) or EMR the cluster is significantly underutilized (no scale-down).</li>
<li><strong>Potential Root Cause/s</strong>:<!-- -->
<ul>
<li><strong>Inefficient YARN Memory Utilization</strong>: Managed scaling may not be triggered if thresholds aren&#x27;t breached, often due to small Yarn containers preventing larger pending containers from launching. This is common when there are multiple running application with container sizes that do not fit neatly onto individual instances.</li>
<li><strong>Scaling Configuration Limits</strong>: Scaling has already reached the upper or lower boundary set in the managed scaling configuration.</li>
<li><strong>Instance Provision Failures</strong>: If scaling started, but eventually failed, which we could see by an uptick in TotalNodesRequested that does not proceed to TotalNodesRunning, this could be due to node to instances failing to provision. This is elaborated on in the next section (stuck scaling).</li>
<li><strong>Application Type</strong>: Managed Scaling triggers are based on Yarn metrics. If the application consuming Cluster resources does not use Yarn as the resource manager, scaling will not occur.</li>
</ul>
</li>
<li><strong>Validate</strong>:<!-- -->
<ul>
<li>Review <a href="https://docs.aws.amazon.com/emr/latest/ManagementGuide/managed-scaling-metrics.html" target="_blank" rel="noopener noreferrer">YARNMemoryAvailablePercentage</a> to ascertain whether Yarn memory consumption is high or low for a sustained period, which would be expected when triggering a scaling event.</li>
<li>Review TotalNodesRequested and TotalNodesRunning in CloudWatch to ensure no scaling request was made or completed during this time.</li>
<li>Review ManagedScaling configuration to ensure that the MinimumCapacityUnits/MaximumCapacityUnits allow for scaling where we can’t scale down past minimum, or up past maximum.</li>
</ul>
</li>
<li><strong>Actions</strong>:<!-- -->
<ul>
<li>Right-size executor containers to efficiently fit within available YARN memory, especially when running multiple applications concurrently.</li>
<li>Check whether maximum or minimum node/unit count is being hit, and change the configuration if required by the workload.</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="stuck-scaling">STUCK SCALING<a href="#stuck-scaling" class="hash-link" aria-label="Direct link to STUCK SCALING" title="Direct link to STUCK SCALING">​</a></h3>
<ul>
<li>
<p><strong>Definition</strong>: A scale-up or scale-down event is initiated but does not complete.</p>
</li>
<li>
<p><strong>Symptoms</strong>: Applications are in a pending state while scaling requests result in increased <a href="https://docs.aws.amazon.com/emr/latest/ManagementGuide/UsingEMR_ViewingMetrics.html#UsingEMR_ViewingMetrics_MetricsReported" target="_blank" rel="noopener noreferrer">TotalNodesRequested</a> without corresponding changes in <a href="https://docs.aws.amazon.com/emr/latest/ManagementGuide/UsingEMR_ViewingMetrics.html#UsingEMR_ViewingMetrics_MetricsReported" target="_blank" rel="noopener noreferrer">TotalNodesRunning</a>. We may see nodes enter a <a href="https://docs.aws.amazon.com/emr/latest/APIReference/API_InstanceGroupStatus.html" target="_blank" rel="noopener noreferrer">terminated/arrested</a> state.</p>
</li>
<li>
<p><strong>Potential Root Cause/s</strong>:</p>
<ul>
<li><strong>Provisioning Failures</strong>: Resources are requested but are unable to be allocated or properly initialized.</li>
<li><strong>Bootstrap Action Failures</strong>: Bootstrap actions can fail during node provisioning, preventing nodes from successfully joining the cluster.</li>
<li><strong>Scaling Down Core Nodes</strong>: Core nodes cannot be scaled down in a way that reduces replication factor. If an EMR cluster has an HDFS replication factor of 2, and we attempt to scale down to a single Core node, scale down will fail as it needs to maintain 2 of each HDFS block on the EMR Cluster.</li>
</ul>
</li>
<li>
<p><strong>Validate</strong>:</p>
<ul>
<li>Review <a href="https://docs.aws.amazon.com/emr/latest/ManagementGuide/UsingEMR_ViewingMetrics.html#UsingEMR_ViewingMetrics_MetricsReported" target="_blank" rel="noopener noreferrer">TotalNodesRequested</a> and <a href="https://docs.aws.amazon.com/emr/latest/ManagementGuide/UsingEMR_ViewingMetrics.html#UsingEMR_ViewingMetrics_MetricsReported" target="_blank" rel="noopener noreferrer">TotalNodesRunning</a> in CloudWatch metrics to verify if node allocation requests are being created by not fulfilled.</li>
<li>Review EMR Cluster instances to check whether they have entered a suspended state</li>
</ul>
</li>
<li>
<p><strong>Actions</strong>:</p>
<ul>
<li>In the event of bootstrap failure or timeouts, review the bootstrap logs to mitigate any errors, and streamline functions that take significant time. This will also help improve scale up times.</li>
</ul>
</li>
<li>
<p><strong>Related Links</strong>:</p>
<ul>
<li><a href="https://docs.aws.amazon.com/emr/latest/APIReference/API_InstanceGroupStatus.html" target="_blank" rel="noopener noreferrer">Instance Group States</a></li>
<li><a href="https://repost.aws/knowledge-center/emr-troubleshoot-stuck-cluster-scaling" target="_blank" rel="noopener noreferrer">Troubleshoot Stuck Scaling</a></li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="escalating-to-aws">Escalating to AWS<a href="#escalating-to-aws" class="hash-link" aria-label="Direct link to Escalating to AWS" title="Direct link to Escalating to AWS">​</a></h2>
<p><strong>Overview</strong>: If an event occurs, and you are unable to discern or rectify the behavior, and it does not align with your expectations, AWS Support is a great resource to get help. Providing sufficient information at case creation prevents potentially lengthy requests for additional information. The following outlines information you can include when opening support cases, and insight into why we need them.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="emr-cluster-id">EMR Cluster-id<a href="#emr-cluster-id" class="hash-link" aria-label="Direct link to EMR Cluster-id" title="Direct link to EMR Cluster-id">​</a></h3>
<p><strong>Why</strong>: The EMR Cluster-id is the unique resource identifier that allows us to understand which EMR Cluster needs to be investigated.</p>
<p><strong>Where</strong>: The EMR Cluster-id can be retrieved from the AWS Console under Services → EMR → Clusters  which should land you on a list of recent clusters. The resource identifier starts with a j- prefix followed by a string of numbers and letters</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="metrics-collector-log">Metrics Collector Log<a href="#metrics-collector-log" class="hash-link" aria-label="Direct link to Metrics Collector Log" title="Direct link to Metrics Collector Log">​</a></h3>
<p><strong>Why</strong>: Metrics collector provides key metrics that help with managed scaling decisions, failures or delay in the metrics collector process can lead to unexpected behavior.</p>
<p><strong>Where</strong>: Log path on leader node: <code>/emr/metricscollector/log/metricscollector.log</code></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="node-and-hdfs-status">Node and HDFS Status<a href="#node-and-hdfs-status" class="hash-link" aria-label="Direct link to Node and HDFS Status" title="Direct link to Node and HDFS Status">​</a></h3>
<p><strong>Why</strong>: In the event that scale resizing is taking a long time, it is important to note the Decommissioning as well as Block Replication status, this allows us to check whether HDFS blocks are underreplicated, and the current status of cluster nodes.</p>
<p><strong>Where</strong>: From the leader node, run $ <code>hdfs dfsadmin -report</code> and attach the output to the case</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="instance-controller-log">Instance Controller log<a href="#instance-controller-log" class="hash-link" aria-label="Direct link to Instance Controller log" title="Direct link to Instance Controller log">​</a></h3>
<p><strong>Why</strong>: Instance Controller monitors the state of instances attached to the EMR Cluster, and is an important resource to observe change requests.</p>
<p><strong>Where</strong>: From the leader node, <code>/emr/instance-controller/log/</code></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/bestpractices/4 - Features/Managed Scaling/troubleshooting.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/aws-emr-best-practices/docs/bestpractices/Features/Managed Scaling/best_practices"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Best Practices</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/aws-emr-best-practices/docs/bestpractices/Features/Spot Usage/best_practices"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Best Practices</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#required-access-to-troubleshoot" class="table-of-contents__link toc-highlight">Required Access to Troubleshoot</a></li><li><a href="#feature-history-best-practices-and-considerations" class="table-of-contents__link toc-highlight">Feature History, Best Practices and Considerations</a></li><li><a href="#understanding-node-allocation-strategies" class="table-of-contents__link toc-highlight">Understanding Node Allocation Strategies</a><ul><li><a href="#common-scaling-scenarios" class="table-of-contents__link toc-highlight">Common Scaling Scenarios</a></li></ul></li><li><a href="#graphing-metrics-related-to-managed-scaling" class="table-of-contents__link toc-highlight">Graphing Metrics Related to Managed Scaling</a></li><li><a href="#validating-and-actioning-scaling-events" class="table-of-contents__link toc-highlight">Validating and Actioning Scaling Events</a><ul><li><a href="#scale-up" class="table-of-contents__link toc-highlight">SCALE UP</a></li><li><a href="#scale-down" class="table-of-contents__link toc-highlight">SCALE DOWN</a></li><li><a href="#slow-scaling" class="table-of-contents__link toc-highlight">SLOW SCALING</a></li><li><a href="#no-scaling" class="table-of-contents__link toc-highlight">NO SCALING</a></li><li><a href="#stuck-scaling" class="table-of-contents__link toc-highlight">STUCK SCALING</a></li></ul></li><li><a href="#escalating-to-aws" class="table-of-contents__link toc-highlight">Escalating to AWS</a><ul><li><a href="#emr-cluster-id" class="table-of-contents__link toc-highlight">EMR Cluster-id</a></li><li><a href="#metrics-collector-log" class="table-of-contents__link toc-highlight">Metrics Collector Log</a></li><li><a href="#node-and-hdfs-status" class="table-of-contents__link toc-highlight">Node and HDFS Status</a></li><li><a href="#instance-controller-log" class="table-of-contents__link toc-highlight">Instance Controller log</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Get Involved</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/aws/aws-emr-best-practices/tree/main" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Built with ❤️ at AWS  <br> © 2024 Amazon.com, Inc. or its affiliates. All Rights Reserved</div></div></div></footer></div>
</body>
</html>