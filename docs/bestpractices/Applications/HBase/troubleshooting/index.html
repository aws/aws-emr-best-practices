<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-bestpractices/Applications/HBase/troubleshooting" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">Troubleshooting | AWS Open Data Analytics</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://aws.github.io/aws-emr-best-practices/img/AWS_logo_RGB.png"><meta data-rh="true" name="twitter:image" content="https://aws.github.io/aws-emr-best-practices/img/AWS_logo_RGB.png"><meta data-rh="true" property="og:url" content="https://aws.github.io/aws-emr-best-practices/docs/bestpractices/Applications/HBase/troubleshooting"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Troubleshooting | AWS Open Data Analytics"><meta data-rh="true" name="description" content="Managing distributed systems like HBase and Hadoop on Amazon EMR can be complex, especially at production scale where reliability, latency, and fault tolerance are critical. This runbook provides hands-on guidance for troubleshooting, recovery, and stability improvement of HBase and Hadoop components when using Amazon EMR."><meta data-rh="true" property="og:description" content="Managing distributed systems like HBase and Hadoop on Amazon EMR can be complex, especially at production scale where reliability, latency, and fault tolerance are critical. This runbook provides hands-on guidance for troubleshooting, recovery, and stability improvement of HBase and Hadoop components when using Amazon EMR."><link data-rh="true" rel="canonical" href="https://aws.github.io/aws-emr-best-practices/docs/bestpractices/Applications/HBase/troubleshooting"><link data-rh="true" rel="alternate" href="https://aws.github.io/aws-emr-best-practices/docs/bestpractices/Applications/HBase/troubleshooting" hreflang="en"><link data-rh="true" rel="alternate" href="https://aws.github.io/aws-emr-best-practices/docs/bestpractices/Applications/HBase/troubleshooting" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-MF59LKNSDN","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><link rel="stylesheet" href="/aws-emr-best-practices/assets/css/styles.28ef5182.css">
<script src="/aws-emr-best-practices/assets/js/runtime~main.6392da9a.js" defer="defer"></script>
<script src="/aws-emr-best-practices/assets/js/main.9ad7564d.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/aws-emr-best-practices/"><b class="navbar__title text--truncate">AWS Open Data Analytics</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/aws-emr-best-practices/docs/bestpractices/introduction">Best Practices</a><a class="navbar__item navbar__link" href="/aws-emr-best-practices/docs/benchmarks/introduction">Benchmarks</a><a class="navbar__item navbar__link" href="/aws-emr-best-practices/docs/migration/introduction">Migration</a><a class="navbar__item navbar__link" href="/aws-emr-best-practices/docs/utilities/introduction">Utilities</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/aws-emr-best-practices/docs/bestpractices/introduction">EMR Best Practices</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/aws-emr-best-practices/docs/bestpractices/Applications/HBase/introduction">Applications</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/aws-emr-best-practices/docs/bestpractices/Applications/HBase/introduction">HBase</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/aws-emr-best-practices/docs/bestpractices/Applications/HBase/introduction">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/aws-emr-best-practices/docs/bestpractices/Applications/HBase/best_practice">Best Practices</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/aws-emr-best-practices/docs/bestpractices/Applications/HBase/best_practice_hdfs">Best Practices for HDFS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/aws-emr-best-practices/docs/bestpractices/Applications/HBase/best_practice_s3">Best Practices for Amazon S3</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/aws-emr-best-practices/docs/bestpractices/Applications/HBase/data_integrity">Data Integrity / High Availability</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/aws-emr-best-practices/docs/bestpractices/Applications/HBase/data_migration">Data Migration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/aws-emr-best-practices/docs/bestpractices/Applications/HBase/management">Management</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/aws-emr-best-practices/docs/bestpractices/Applications/HBase/observability">Observability</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/aws-emr-best-practices/docs/bestpractices/Applications/HBase/performance_tests">Performance Tests</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/aws-emr-best-practices/docs/bestpractices/Applications/HBase/security">Security</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/aws-emr-best-practices/docs/bestpractices/Applications/HBase/troubleshooting">Troubleshooting</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/aws-emr-best-practices/docs/bestpractices/Applications/Hadoop/introduction">Hadoop</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/aws-emr-best-practices/docs/bestpractices/Applications/Hive/introduction">Hive</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/aws-emr-best-practices/docs/bestpractices/Applications/Spark/introduction">Spark</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/aws-emr-best-practices/docs/bestpractices/Cost Optimizations/Introduction">Cost Optimizations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/aws-emr-best-practices/docs/bestpractices/Features/EMRFS/aimd">Features</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/aws-emr-best-practices/docs/bestpractices/Observability/intro">Observability</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/aws-emr-best-practices/docs/bestpractices/Reliability/introduction">Reliability</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/aws-emr-best-practices/docs/bestpractices/Security/introduction">Security</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/aws-emr-best-practices/docs/bestpractices/Troubleshooting/Troubleshooting EMR">Troubleshooting</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/aws-emr-best-practices/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Applications</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">HBase</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Troubleshooting</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Troubleshooting</h1></header>
<p>Managing distributed systems like <strong>HBase</strong> and <strong>Hadoop</strong> on <strong>Amazon EMR</strong> can be complex, especially at production scale where reliability, latency, and fault tolerance are critical. This runbook provides hands-on guidance for troubleshooting, recovery, and stability improvement of HBase and Hadoop components when using Amazon EMR.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="hbase-issues">HBase Issues<a href="#hbase-issues" class="hash-link" aria-label="Direct link to HBase Issues" title="Direct link to HBase Issues">​</a></h2>
<p>This section focuses on common issues within HBase itself that can directly affect the health, performance, and availability of your cluster. Understanding and addressing these issues is crucial for ensuring data availability, maintaining performance, and preventing long-term inconsistencies or data loss.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="important-notes">Important Notes<a href="#important-notes" class="hash-link" aria-label="Direct link to Important Notes" title="Direct link to Important Notes">​</a></h3>
<ul>
<li>Some commands in this guide perform <strong>destructive or structural actions</strong> (e.g., region assignment, HDFS deletes). Always validate first on staging environments.</li>
<li>Use <code>hbck2</code> over <code>hbck</code> for HBase 2.x clusters. The original <code>hbck</code> is <strong>deprecated and unsafe</strong> for structural repairs.</li>
<li>Take <strong>backups or snapshots</strong> before attempting recovery procedures that affect region or file system state.</li>
</ul>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="hbase-master-not-starting">HBase Master Not Starting<a href="#hbase-master-not-starting" class="hash-link" aria-label="Direct link to HBase Master Not Starting" title="Direct link to HBase Master Not Starting">​</a></h3>
<p><strong>Description</strong></p>
<p>The HBase Master process may fail to start for several reasons, including misconfigured or unreachable ZooKeeper quorum, stale ZooKeeper lock files, port conflicts (often caused by custom software or agents installed on the node), unformatted or inconsistent HDFS state, or failures in loading meta regions. Without an active HBase Master, RegionServers cannot operate, leaving the HBase cluster unavailable.</p>
<p><strong>Symptoms</strong></p>
<ul>
<li>Errors in logs such as <code>java.net.BindException</code> (port conflict)</li>
<li>Messages like <code>Master startup aborted</code></li>
<li>No active master shown in the HBase Web UI</li>
<li>HDFS safe mode is active, blocking the HBase root directory check</li>
<li>Repeated connection or session loss errors to ZooKeeper in master logs</li>
</ul>
<p><strong>Investigation</strong></p>
<ul>
<li><strong>Examine HBase Master Logs</strong> Look for critical errors indicating root causes:</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">less /var/log/hbase/hbase-hbase-master-*.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">grep -i &quot;ConnectionLossException&quot; /var/log/hbase/hbase-hbase-master-*.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">grep -i &quot;Could not start master&quot; /var/log/hbase/hbase-hbase-master-*.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">grep -i &quot;safe mode&quot; /var/log/hbase/hbase-hbase-master-*.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">grep -i &quot;Exception&quot; /var/log/hbase/hbase-hbase-master-*.log</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><strong>Confirm HDFS Health and Availability</strong></li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Check if HDFS is in Safe Mode (should be OFF)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hdfs dfsadmin -safemode get</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Confirm the HBase root directory exists and is accessible</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hdfs dfs -ls /user/hbase/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Verify that /user/hbase and all its subfolders/files are owned by hbase:hbase</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># NOTE: If the output is empty, all ownership is correct. </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Any lines shown indicate files/directories NOT owned by hbase:hbase</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hdfs dfs -ls -R /user/hbase/ | awk &#x27;$3 != &quot;hbase&quot; || $4 != &quot;hbase&quot;&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><strong>Check ZooKeeper Quorum and Health</strong> Confirm all ZooKeeper ensemble nodes are healthy.</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Extract hbase.zookeeper.quorum value from hbase-site.xml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zk_quorum=$(grep -A2 &#x27;&lt;name&gt;hbase.zookeeper.quorum&lt;/name&gt;&#x27; /etc/hbase/conf/hbase-site.xml | grep &#x27;&lt;value&gt;&#x27; | sed &#x27;s/.*&lt;value&gt;\(.*\)&lt;\/value&gt;.*/\1/&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;ZooKeeper quorum: $zk_quorum&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Loop through all ZooKeeper hosts and try to connect</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IFS=&#x27;,&#x27; read -ra zk_hosts &lt;&lt;&lt; &quot;$zk_quorum&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">for host in &quot;${zk_hosts[@]}&quot;; do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  echo &quot;Trying to connect to ZooKeeper node: $host:2181&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if echo &quot;quit&quot; | zookeeper-client -server ${host}:2181 2&gt;&amp;1 | grep -qi &#x27;connected&#x27;; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &quot;SUCCESS: Connected to $host:2181&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &quot;FAILED: Could not connect to $host:2181&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  echo &quot;-----------------------------&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">done</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><strong>Check for Port Conflicts</strong></li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Find processes using HBase Master ports (default: 16000, 16010)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo netstat -tulnp | grep 16000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo netstat -tulnp | grep 16010</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Resolution</strong></p>
<ul>
<li><strong>Release HDFS Safe Mode (if applicable)</strong> Only do this after investigating and resolving any underlying HDFS issues:</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">hdfs dfsadmin -safemode leave</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>
<p><strong>Resolve Port Conflicts (if applicable)</strong> Stop or reconfigure any process occupying HBase Master ports (default: 16000, 16010).</p>
</li>
<li>
<p><strong>Fix HDFS Permission Issues (if applicable)</strong></p>
</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">hdfs dfs -chown -R hbase:hbase /user/hbase/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><strong>Restart the HBase Master Service</strong></li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl restart hbase-master</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Prevention</strong></p>
<ul>
<li>Regularly monitor HDFS safe mode status and ZooKeeper ensemble health.</li>
<li>Avoid running custom agents or services that might conflict with HBase Master ports.</li>
<li>Configure HBase for High Availability by running <a href="https://docs.aws.amazon.com/emr/latest/ManagementGuide/emr-plan-ha-launch.html" target="_blank" rel="noopener noreferrer">multiple master nodes</a></li>
</ul>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="hbase-regionserver-crashes">HBase RegionServer Crashes<a href="#hbase-regionserver-crashes" class="hash-link" aria-label="Direct link to HBase RegionServer Crashes" title="Direct link to HBase RegionServer Crashes">​</a></h3>
<p><strong>Description</strong></p>
<p>RegionServers may crash due to memory exhaustion (<code>OutOfMemoryError</code>), prolonged garbage collection (GC) pauses, disk or filesystem failures, or corrupted write-ahead logs (WAL). While the HBase Master typically reassigns the affected regions automatically, sometimes a crash can leave regions unassigned or stuck in transition (Region-In-Transition, or RIT), resulting in data unavailability or degraded cluster performance.</p>
<p><strong>Symptoms</strong></p>
<ul>
<li>Frequent client errors such as <code>Connection reset by peer</code></li>
<li>Increased latency for read and write operations</li>
<li>Errors in RegionServer logs, e.g., <code>Region not online</code> or <code>RegionNotServingException</code></li>
<li>Regions remaining in the RIT (Region-In-Transition) state</li>
<li>Unassigned regions observed in the HBase Master UI or via shell</li>
</ul>
<p><strong>Investigation</strong></p>
<ul>
<li><strong>Inspect RegionServer Logs</strong> Check logs for critical issues, such as memory errors, Zookeeper connection problems, or abnormal region closures:</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">less /var/log/hbase/hbase-hbase-regionserver-*.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">grep -i &quot;OutOfMemoryError&quot; /var/log/hbase/hbase-hbase-regionserver-*.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">grep -i &quot;regionserver aborting&quot; /var/log/hbase/hbase-hbase-regionserver-*.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">grep -i &quot;ClosedChannelException&quot; /var/log/hbase/hbase-hbase-regionserver-*.log</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><strong>Evaluate RegionServer Resources</strong>  Assess memory, CPU, file descriptors, and disk health:</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Get RegionServer PID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rs_pid=`sudo jps -v | grep HRegionServer | awk -F&#x27; &#x27; &#x27;{print $1}&#x27;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Memory and CPU usage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo ps -p $rs_pid -o %mem,%cpu,cmd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Number of open file descriptors (sockets, files, etc.)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo lsof -u hbase | wc -l</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Disk space and I/O status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df -h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iostat -xm 2 5</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><strong>Analyze Garbage Collection Performance</strong> Identify if long GC pauses are causing service interruptions:</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Get RegionServer PID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rs_pid=`sudo jps -v | grep HRegionServer | awk -F&#x27; &#x27; &#x27;{print $1}&#x27;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Garbage Collection statistics</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo -u hbase jstat -gcutil $rs_pid 5000 10</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Resolution</strong></p>
<ul>
<li><strong>Restart the affected RegionServer</strong></li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl restart hbase-regionserver</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>
<p><strong>Verify that regions are reassigned by the HBase Master</strong> Use the Master Web UI or HBase shell</p>
</li>
<li>
<p><strong>Check for and fix stuck regions using hbck</strong></p>
</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">alias hbck=&quot;sudo -u hbase hbase hbck -details&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hbck</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Prevention</strong></p>
<ul>
<li><strong>Increase memory allocation</strong> in <code>hbase-env.sh</code> as appropriate for your workload: <code>export HBASE_REGIONSERVER_OPTS-=4096</code> or use the following EMR Classification:</li>
</ul>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Classification&quot;: &quot;hbase-env&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Configurations&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;Classification&quot;: &quot;export&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;Properties&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;HBASE_REGIONSERVER_OPTS&quot;: &quot;\&quot;$HBASE_REGIONSERVER_OPTS -Xmx30g\&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Properties&quot;: {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>Raise file descriptor limits for the <code>hbase</code> user:</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ulimit -n 65536</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Persistently configure this in <code>/etc/security/limits.conf</code>.</p>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="slow-reads-or-writes">Slow Reads or Writes<a href="#slow-reads-or-writes" class="hash-link" aria-label="Direct link to Slow Reads or Writes" title="Direct link to Slow Reads or Writes">​</a></h3>
<p><strong>Description</strong></p>
<p>Performance degradation in HBase, seen as slow reads or writes, is frequently caused by I/O bottlenecks, memstore flush pressure, compaction backlog, high store file counts, or suboptimal region distribution. These issues can arise from hardware limits, application write patterns, or table design.</p>
<p><strong>Symptoms</strong></p>
<ul>
<li>High read or write latency (e.g., read latencies &gt;100ms) visible in the HBase UI or monitoring dashboards</li>
<li>Frequent or queued memstore flushes</li>
<li>Elevated store file counts per region</li>
<li>Write throughput drops or client timeouts</li>
<li>Key metrics indicate problems, such as:<!-- -->
<ul>
<li>Low blockCacheHitRatio</li>
<li>High memstoreSizeMB</li>
<li>Large flushQueueLength</li>
</ul>
</li>
</ul>
<p><strong>Investigation</strong>:</p>
<ul>
<li>Monitor RegionServer Metrics in the Web UI or directly in <a href="https://docs.aws.amazon.com/emr/latest/ReleaseGuide/AmazonCloudWatchAgent-config-710.html" target="_blank" rel="noopener noreferrer">CloudWatch</a>: Open <code>http://&lt;regionserver&gt;:16030/jmx</code> for regionserver stats including flush and compaction queues, store file counts, and latency. As alternative, if you don&#x27;t have any monitoring setup in place, you can use the following script to retrieve metrics of interest across all RegionServers of the cluster.</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#!/bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HBASE_REST_HOST=`hostname -f`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REST_PORT=&quot;16010&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Define HBase Namespace and table Name for which</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># you want specific latency metrics</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HBASE_NS=&quot;default&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HBASE_TABLE=&quot;TestTable&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Get the list of RegionServers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RS_LIST=$(curl -s &quot;http://${HBASE_REST_HOST}:${REST_PORT}/jmx?qry=Hadoop:service=HBase,name=Master,sub=Server&quot; | jq -r &#x27;.beans[0][&quot;tag.liveRegionServers&quot;]&#x27; | tr &#x27;;&#x27; &#x27;\n&#x27; | awk -F&#x27;,&#x27; &#x27;{print $1}&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;RegionServers found:&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;$RS_LIST&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># For each RegionServer, retrieve and print latency metrics </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># NOTE - Latency metrics for latest EMR release emr 7.9.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">for RS in $RS_LIST; do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  echo &quot;RegionServer: $RS&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Retrieve JMX metrics for this RegionServer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  RS_JMX=$(curl -s &quot;http://${RS}:16030/jmx&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Example: Print few RS metrics</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  echo &quot;Generic RS metrics&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rs_metrics=&quot;readRequestRatePerSecond,writeRequestRatePerSecond,l1CacheHitRatio,l1CacheMissRatio,l2CacheHitRatio,l2CacheMissRatio,Get_min,Get_max&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  echo &quot;$RS_JMX&quot; | jq &#x27;.beans[] | select(.name==&quot;Hadoop:service=HBase,name=RegionServer,sub=Server&quot;) | {&#x27;$rs_metrics&#x27;}&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  echo &quot;Table $HBASE_NS.$HBASE_TABLE metrics&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  table_latency_sub=&quot;TableRequests_Namespace_${HBASE_NS}_table_${HBASE_TABLE}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  table_metrics=&quot;GetTime_min,GetTime_max,GetTime_mean,ScanTime_min,ScanTime_max,ScanTime_mean,PutBatchTime_min,PutBatchTime_max,PutBatchTime_mean&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  echo &quot;$RS_JMX&quot; | jq &#x27;.beans[] | select(.name==&quot;Hadoop:service=HBase,name=RegionServer,sub=&#x27;$table_latency_sub&#x27;&quot;) | {&#x27;$table_metrics&#x27;}&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  echo &quot;-----------------------------&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">done</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Adjust <code>rs_metrics</code> and <code>table_metrics</code> based on your needs.</p>
<ul>
<li><strong>Check for Excessive Store Files</strong> Too many store files per region can slow down reads and increase compaction pressure:</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">hdfs dfs -count -q -h -v /user/hbase/data/&lt;namespace&gt;/&lt;table&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>
<p><strong>Check Memstore Flush Frequency</strong> Frequent flushes may indicate memory pressure or uneven data distribution.</p>
</li>
<li>
<p><strong>Use HBase Shell to Flush and Compact</strong></p>
<ul>
<li>Flush a table to force memstore to HFiles:</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">hbase shell</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; flush &#x27;tablename&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>Manually trigger major compaction to reduce store files:</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">hbase shell</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; major_compact &#x27;tablename&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p><strong>Identify and Split Hot Regions</strong></p>
<ul>
<li>In the Web UI, find regions with high request or size skew.</li>
<li>Split large or heavily loaded regions:</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">hbase shell</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; split &#x27;region_name&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ul>
<p><strong>Resolution</strong></p>
<ul>
<li><strong>Manually Compact Store Files</strong>  Use major compaction to consolidate store files and reduce read latency:</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">hbase shell</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; major_compact &#x27;tablename&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><strong>Split Hot Regions</strong> Identify oversized or high-traffic regions in the HBase UI and split them to distribute load.</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">hbase shell</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; split &#x27;region_name&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>
<p><strong>Pre-Split Tables for Bulk Loads</strong> Before loading large datasets, create tables with pre-split regions to avoid early hotspots.</p>
</li>
<li>
<p><strong>Tune Block Cache and Memstore Parameters</strong> Adjust settings such as:</p>
<ul>
<li>hbase.hstore.blockingStoreFiles</li>
<li>hbase.regionserver.global.memstore.size</li>
<li>hbase.regionserver.flush.queue.size</li>
</ul>
</li>
</ul>
<p><strong>Prevention</strong></p>
<ul>
<li>
<p><strong>Set Reasonable Store File and Memstore Limits</strong> Carefully configure <code>hbase.hstore.blockingStoreFiles</code> and <code>hbase.regionserver.global.memstore.size</code> to balance flush and compaction activity.</p>
</li>
<li>
<p><strong>Enable Periodic Compactions</strong> Schedule short major compactions during off-peak hours (e.g., at night) to keep store file counts under control. Set <code>hbase.offpeak.start.hour</code> and <code>hbase.offpeak.end.hour</code>.</p>
</li>
<li>
<p><strong>Monitor and Alert on Key Metrics</strong> Set up monitoring and alerts for latency, store file count, flush queue length, and block cache hit ratio.</p>
</li>
<li>
<p><strong>Design Tables for Even Region Distribution</strong> Use well-designed rowkeys and pre-splitting to prevent region hotspots.</p>
</li>
</ul>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="table-inconsistencies">Table Inconsistencies<a href="#table-inconsistencies" class="hash-link" aria-label="Direct link to Table Inconsistencies" title="Direct link to Table Inconsistencies">​</a></h3>
<p><strong>Description</strong></p>
<p>Table inconsistencies in HBase can manifest as missing regions, orphaned regions, incorrect region assignments, holes in the key space, or files present in HDFS but not referenced in HBase metadata. These issues can arise due to failed region splits/merges, abrupt node failures, manual file operations in HDFS, or incomplete administrative actions.</p>
<p><strong>Symptoms</strong></p>
<ul>
<li>Errors when scanning or writing to tables (e.g., <code>RegionNotServingException</code>, missing rows)</li>
<li><code>hbase hbck</code> reports inconsistencies, such as &quot;region holes&quot;, &quot;orphaned regions&quot; or &quot;table is inconsistent&quot;</li>
<li>Table shows as <code>DISABLED</code> or is unavailable in the HBase shell/UI</li>
<li>Regions stuck in transition (RIT)</li>
</ul>
<p><strong>Investigation</strong></p>
<ul>
<li>
<p><strong>Run HBCK Tool (HBase 1.x &amp; HBase 2.x)</strong> Check for inconsistencies:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">alias hbck=&quot;sudo -u hbase hbase hbck -details&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hbck</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>As alternative you can use the <code>HBCK</code> report page in the HBase Web UI ta</p>
<p><strong>Note</strong> For HBase 2.x clusters, use <code>HBCK 1</code> only for generating reports. Do <strong>NOT</strong> use it for repairs or recovery, as it is not compatible with HBase 2.x internals and may corrupt your table data. However, running <code>hbase hbck -details</code> to generate inconsistency reports is safe on HBase 2.x clusters.</p>
</li>
<li>
<p><strong>Review HBCK Report Page in the HBase Web UI</strong> Starting with HBase 2.1.6, the Master Web UI includes an HBCK Report page (<code>/hbck.jsp</code>). This page provides valuable insight into cluster health by summarizing the results of two background inspections:
CatalogJanitor Output:</p>
<ul>
<li>The CatalogJanitor runs periodically to inspect the hbase<!-- -->:meta<!-- --> table for region overlaps or holes. Any inconsistencies it finds are listed in the HBCK Report section of the UI.</li>
<li>Meta vs. Filesystem Check: Another background chore compares entries in hbase<!-- -->:meta<!-- --> with the actual file-system content. If anomalies (such as orphaned files or mismatched regions) are found, they are also reported on this page.</li>
</ul>
<p>You can manually trigger these inspections from the HBase shell:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Run the CatalogJanitor inspection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">catalogjanitor_run</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Run the HBCK chore inspection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hbck_chore_run</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p><strong>Review Master and RegionServer Logs</strong> Look for messages about region assignment failures, missing regions, or meta table errors:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">grep -i &#x27;inconsistent&#x27; /var/log/hbase/hbase-hbase-master-*.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">grep -i &#x27;orphan&#x27; /var/log/hbase/hbase-hbase-regionserver-*.log</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ul>
<p><strong>Resolution (HBase 2.x)</strong></p>
<ul>
<li>
<p><strong>Lingering Reference File Detected</strong> <code>ERROR: Found lingering reference file &lt;File Name&gt;</code></p>
<ul>
<li>
<p>Identify the lingering reference files reported by the error.</p>
</li>
<li>
<p>Move the files out of the HBase root directory (do not delete them immediately—as a best practice, keep them as a backup in case of recovery needs).</p>
</li>
<li>
<p>Run an HBCK report to verify if the Region-In-Transition (RIT) or inconsistency is resolved:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">alias hbck=&quot;sudo -u hbase hbase hbck -details&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hbck</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ul>
<p>If the affected table is a Phoenix data table, check for related index tables and confirm their health and consistency.</p>
</li>
<li>
<p><strong>Region Not Deployed on Any RegionServer</strong> <code>ERROR: Region { meta =&gt; &lt;Table&gt;, &lt;HBase Region Path&gt; deployed =&gt; , replicaId =&gt; } not deployed on any region server.</code></p>
<ul>
<li>
<p>Assign the region manually using the HBCK2 tool:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">alias hbck2=&quot;sudo -u hbase hbase hbck -j /usr/lib/hbase-operator-tools/hbase-hbck2.jar&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hbck2 -s assigns &lt;region_encoded_name&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Check for stuck procedures related to the region assignment (use HBase Master UI &gt; Procedures or logs).</p>
</li>
<li>
<p>If a stuck procedure exists, bypass it and retry assignment:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">alias hbck2=&quot;sudo -u hbase hbase hbck -j /usr/lib/hbase-operator-tools/hbase-hbck2.jar&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hbck2 -s bypass -o -r &lt;procedure_ID&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hbck2 -s assigns &lt;region_encoded_name&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ul>
</li>
<li>
<p><strong>Overlapping Regions</strong> <code>ERROR: (regions &lt;Encoded region name&gt; and &lt;Encoded region name&gt;) There is an overlap in the region chain.</code></p>
<ul>
<li>
<p>Manually merge the overlapping regions in the HBase shell:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;merge_region &#x27;ENCODED_REGIONNAME_1&#x27;, &#x27;ENCODED_REGIONNAME_2&#x27;&quot; | sudo -u hbase hbase shell</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ul>
</li>
<li>
<p><strong>Region Found in META, Not in HDFS, and Deployed</strong> <code>ERROR: Region &lt;&gt; hdfs =&gt; null, deployed =&gt; xxx, replicaId =&gt; 0 } found in META, but not in HDFS, and deployed on xxx</code></p>
<ul>
<li>
<p>Unassign region using HBCK2:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">alias hbck2=&quot;sudo -u hbase hbase hbck -j /usr/lib/hbase-operator-tools/hbase-hbck2.jar&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hbck2 -s &lt;region_encoded_name&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Fix extra regions in meta using HBCK2:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">alias hbck2=&quot;sudo -u hbase hbase hbck -j /usr/lib/hbase-operator-tools/hbase-hbck2.jar&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hbck2 extraRegionsInMeta --fix &lt;table_name&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ul>
</li>
<li>
<p><strong>Region Not Found in META, Found in HDFS, and Deployed</strong> <code>ERROR: Region { meta =&gt; null, hdfs =&gt; xxx, deployed =&gt; yyy, replicaId =&gt; 0 } not in META, but deployed on xxx</code></p>
<ul>
<li>
<p>Fix missing regions in meta using HBCK2:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">alias hbck2=&quot;sudo -u hbase hbase hbck -j /usr/lib/hbase-operator-tools/hbase-hbck2.jar&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hbck2 addFsRegionsMissingInMeta &lt;table_name&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>If successful you should see a message similar to: <code>N regions were added to META, but these are not yet on Masters cache.</code>
This will also show additional instructions that include restart of HBase master and manual assignment of added regions.</p>
</li>
<li>
<p>Restart HBase Master:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl restart hbase-master.service</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Assign added regions using HBCK command:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">hbck2 -s assigns &lt;encoded_region_name&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ul>
</li>
<li>
<p><strong>Table Inconsistency or WAITING_TIMEOUT in Procedures</strong></p>
<ul>
<li>
<p>Check the HBase Master UI under &quot;Procedures&quot; and &quot;Locks&quot; for any assign procedures stuck in WAITING_TIMEOUT.</p>
</li>
<li>
<p>Bypass the stuck procedure and retry the region assignment:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">alias hbck2=&quot;sudo -u hbase hbase hbck -j /usr/lib/hbase-operator-tools/hbase-hbck2.jar&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hbck2 -s bypass -o -r &lt;procedure_ID&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hbck2 -s assigns &lt;region_encoded_name&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ul>
</li>
<li>
<p><strong>Region Holes</strong> <code>ERROR: There is a hole in the region chain between xxx and yyy.  You need to create a new .regioninfo and region dir in hdfs to plug the hole.</code></p>
<ul>
<li>
<p>Run <code>fixMeta</code> to fix bad or inconsistent state in hbase<!-- -->:meta</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">alias hbck2=&quot;sudo -u hbase hbase hbck -j /usr/lib/hbase-operator-tools/hbase-hbck2.jar&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hbck2 fixMeta</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ul>
</li>
</ul>
<p><strong>Prevention</strong></p>
<ul>
<li>Always use HBase shell or admin tools for region and table operations. Avoid manual file management in HDFS for HBase tables.</li>
<li>Perform regular hbck or hbck2 audits to catch inconsistencies early.</li>
<li>Backup metadata and tables before performing major operations or upgrades.</li>
<li>Monitor master/regionserver logs for early warning signs of inconsistency or failed assignments.</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="hadoop-hdfs-issues">Hadoop HDFS Issues<a href="#hadoop-hdfs-issues" class="hash-link" aria-label="Direct link to Hadoop HDFS Issues" title="Direct link to Hadoop HDFS Issues">​</a></h2>
<p>This section covers common Hadoop HDFS issues that can significantly impact your HBase cluster. HDFS-related problems can lead to critical disruptions affecting cluster availability and data integrity. Addressing these issues promptly is essential, as HBase directly depends on HDFS for data storage, retrieval, and durability.</p>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="namenode-high-memorycpu-usage">NameNode High Memory/CPU Usage<a href="#namenode-high-memorycpu-usage" class="hash-link" aria-label="Direct link to NameNode High Memory/CPU Usage" title="Direct link to NameNode High Memory/CPU Usage">​</a></h3>
<p><strong>Description</strong></p>
<p>The NameNode manages all HDFS file system metadata in memory, including the directory structure, file/block mappings, and permissions. Excessive memory or CPU usage on the NameNode is typically caused by a high number of small files, deep or complex directory hierarchies. If overloaded, the NameNode can suffer from long garbage collection (GC) pauses, unresponsiveness, or even crashes due to Java heap exhaustion.</p>
<p><strong>Symptoms</strong></p>
<ul>
<li>Slow or unresponsive NameNode Web UI (http://EMR_MASTER_NODE:9870 or https://EMR_MASTER_NODE:9871 if in-transit encryption is enabled)</li>
<li>Frequent or prolonged garbage collection events</li>
<li>HDFS enters safe mode, visible in logs or via errors like: java.io.IOException: <code>File system is in safe mode</code></li>
<li>Job failures or timeouts when interacting with HDFS</li>
<li>Cluster monitoring tools show high NameNode memory or CPU usage</li>
</ul>
<p><strong>Investigation</strong></p>
<ul>
<li><strong>Check NameNode Heap and GC Behavior</strong></li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">nn_pid=`sudo jps -v | grep NameNode | awk -F&#x27; &#x27; &#x27;{print $1}&#x27;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo jstat -gcutil $nn_pid 5s 10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">top -p $nn_pid</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><strong>Monitor Namespace and Block Report</strong> Get summary of total files, directories, and blocks:</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">hdfs dfsadmin -report</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hdfs dfs -count -q -h -v /</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><strong>Analyze Number of Small Files</strong> Get block count and compare to file count (if similar, you likely have too many small files):</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">hdfs fsck / | grep &#x27;Total blocks (validated):&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hdfs dfs -count -v /</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Large numbers of files with one or very few blocks is a classic sign of a small file problem.</p>
<ul>
<li><strong>Review Logs for Errors or Safe Mode Events</strong> Look for memory errors or safe mode transitions in the NameNode logs:</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">less /var/log/hadoop-hdfs/hadoop-hdfs-namenode-*.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">grep -i &quot;safe mode&quot; /var/log/hadoop-hdfs/hadoop-hdfs-namenode-*.log</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Resolution</strong></p>
<ul>
<li><strong>Increase NameNode Heap Size</strong> In hadoop-env.sh modify <code>export HADOOP_NAMENODE_HEAPSIZE=8192</code> (set a value accordingly to your needs) or use the following EMR classification:</li>
</ul>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Classification&quot;: &quot;hadoop-env&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Configurations&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;Classification&quot;: &quot;export&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;Properties&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;HADOOP_NAMENODE_HEAPSIZE&quot;: &quot;8192&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Properties&quot;: {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><strong>Consolidate Small Files</strong> Merge small files. If this is due to HBase Storefiles, make sure you haven&#x27;t disabled Compactions, and eventually run a Major Compaction to reduce the overall number of files in your tables.</li>
</ul>
<p><strong>Prevention</strong></p>
<ul>
<li>
<p><strong>Design your HBase tables to Avoid Small Files</strong> This typically requires to avoid creating tables with a high number of column families. Generally best practice recommend to use no more than 1 or two column families per table.</p>
</li>
<li>
<p><strong>Regular Namespace Auditing</strong> Periodically review file and block counts; set CloudWatch alerts for rapid increases.</p>
</li>
</ul>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="hdfs-under-replication">HDFS Under-Replication<a href="#hdfs-under-replication" class="hash-link" aria-label="Direct link to HDFS Under-Replication" title="Direct link to HDFS Under-Replication">​</a></h3>
<p><strong>Description</strong></p>
<p>HDFS under-replication occurs when one or more data blocks have fewer replicas than the configured <a href="https://docs.aws.amazon.com/emr/latest/ReleaseGuide/emr-hdfs-config.html" target="_blank" rel="noopener noreferrer">HDFS replication factor</a>. This typically results from DataNode failures, decommissioning, or disk errors, leaving some blocks at risk of data loss if additional nodes fail.</p>
<p><strong>Symptoms</strong></p>
<ul>
<li>The HDFS NameNode Web UI shows “Under-replicated blocks” or “Missing replicas”</li>
<li><code>hdfs fsck</code> reports blocks under-replicated or missing</li>
<li>Alerts or metrics such as <code>UnderReplicatedBlocks</code> spike in monitoring dashboards</li>
<li>Applications reading under-replicated files may encounter errors if additional failures occur</li>
</ul>
<p><strong>Investigation</strong></p>
<ul>
<li><strong>Check HDFS Block Health</strong> Run a file system check to identify under-replicated blocks:</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># List files with under-replicated blocks and their locations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo -u hdfs hdfs fsck / -blocks -locations -racks</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Note</strong>: In small clusters (fewer than 10 nodes), you may notice under-replicated JAR files being reported. This happens because, by default, YARN sets a replication factor of 10 for shared library files created when a user submits a YARN job. This behavior is controlled by the <code>yarn.sharedcache.nm.uploader.replication.factor</code> property, which defaults to 10.</p>
<p><strong>Resolution</strong></p>
<ul>
<li>
<p><strong>Wait for HDFS Self-Healing</strong> HDFS attempts to automatically restore the desired replication factor when DataNodes recover or new nodes join.</p>
</li>
<li>
<p><strong>Manually set replication</strong> <code>hdfs dfs -setrep -w 3 /path/to/file</code>
Adjust the replication factor (3 in the example) as appropriate for your environment.</p>
</li>
<li>
<p><strong>Bulk Fix Under-Replicated Files</strong></p>
</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Generate a file with under-replicated HDFS blocks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo -u hdfs hdfs fsck / | grep &#x27;Under replicated&#x27; | awk -F&#x27;:&#x27; &#x27;{print $1}&#x27; &gt;&gt; /tmp/under_replicated_files</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Fix replication issues</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># NOTE - adjust HDFS_REPLICATION accordingly to your needs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HDFS_REPLICATION=3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">for hdfs_file in `cat /tmp/under_replicated_files`; do </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &quot;Fixing $hdfs_file...&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hdfs dfs -setrep -w $HDFS_REPLICATION $hdfs_file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">done</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><strong>Restore DataNodes</strong> If under-replication is due to node failure, restore or replace failed DataNodes and ensure they are healthy and rejoin the cluster.</li>
</ul>
<p><strong>Prevention</strong>:</p>
<ul>
<li>
<p><strong>Monitor Cluster Health</strong>  Set up alerts for under-replicated blocks using HDFS metrics (UnderReplicatedBlocks in <a href="https://docs.aws.amazon.com/emr/latest/ManagementGuide/UsingEMR_ViewingMetrics.html" target="_blank" rel="noopener noreferrer">CloudWatch Metrics</a> exposed by EMR clusters or your preferred monitoring system).</p>
</li>
<li>
<p><strong>Maintain Sufficient DataNodes</strong> Ensure enough healthy DataNodes to meet your desired replication factor, especially before decommissioning nodes.</p>
</li>
<li>
<p><strong>Optimize HDFS Replication Settings</strong> Add or tune these configurations to accelerate detection and correction of under-replicated blocks:</p>
</li>
</ul>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Classification&quot;: &quot;hdfs-site&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Properties&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;dfs.namenode.heartbeat.recheck-interval&quot;: &quot;15000&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;dfs.namenode.replication.max-streams&quot;: &quot;100&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;dfs.namenode.replication.max-streams-hard-limit&quot;: &quot;200&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;dfs.namenode.replication.work.multiplier.per.iteration&quot;: &quot;50&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;dfs.replication&quot;: &quot;3&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="hdfs-block-corruption">HDFS Block Corruption<a href="#hdfs-block-corruption" class="hash-link" aria-label="Direct link to HDFS Block Corruption" title="Direct link to HDFS Block Corruption">​</a></h3>
<p><strong>Description</strong></p>
<p>HDFS block corruption occurs when a block’s data becomes unreadable, typically due to disk hardware failures, incomplete writes, or checksum mismatches. This can lead to data loss if not detected and remediated promptly, especially for critical data like HBase store files.</p>
<p><strong>Symptoms</strong></p>
<ul>
<li><code>ChecksumException</code> or similar errors in DataNode or client logs</li>
<li><code>hdfs fsck</code> reports corrupt or missing blocks</li>
<li>Unexpected file read failures or application errors when accessing data</li>
</ul>
<p><strong>Investigation</strong></p>
<ul>
<li><strong>Identify Corrupted Blocks</strong> Use HDFS fsck to list all corrupt file blocks:</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">hdfs fsck / -list-corruptfileblocks</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>
<p><strong>Check DataNode Logs</strong> Review logs on DataNodes hosting the affected blocks for disk errors, checksum failures, or volume failures.</p>
</li>
<li>
<p><strong>Corruption Context</strong> For HBase, check if the corrupted blocks belong to HBase store files, WALs, or other important files like tables descriptors or region info files. If so, cross-reference with HBase logs for corresponding errors or data loss.</p>
</li>
</ul>
<p><strong>Resolution</strong></p>
<ul>
<li>
<p><strong>HBase Store File Corruption</strong>  If corruption affects HBase files and is impossible to recover them, the only safe recovery is to delete and restore the data from a valid HBase Snapshot. If you&#x27;re not sure on what action you should take, please contact AWS Support for additional help.</p>
</li>
<li>
<p><strong>Other Data</strong> If the file can be recreated or re-ingested, delete the corrupted file and restore from backup or source. To delete a corrupted file: <code>hdfs dfs -rm /path/to/corrupted/file</code></p>
</li>
</ul>
<p><strong>WARNING</strong> Before deleting any file, ensure that recovery is not possible by other means. Sometimes a block is marked as corrupt because one or more DataNodes are temporarily down, not because the data is permanently lost. If affected DataNodes are still operational, review their health and logs to see if the data can be recovered before removal.</p>
<p><strong>Prevention</strong></p>
<ul>
<li>
<p><strong>Regular Backups and Snapshots</strong> Periodically back up HBase tables and maintain recent snapshots to enable rapid recovery in case of corruption events.</p>
</li>
<li>
<p><strong>Validate Replication</strong> Ensure the replication factor is sufficient to tolerate node or disk failures.</p>
</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="hadoop-yarn-issues">Hadoop YARN Issues<a href="#hadoop-yarn-issues" class="hash-link" aria-label="Direct link to Hadoop YARN Issues" title="Direct link to Hadoop YARN Issues">​</a></h2>
<p>This section addresses common Hadoop YARN issues that could impact your HBase cluster. While these typically aren&#x27;t critical threats to cluster stability or data integrity, resolving them can be beneficial, especially since certain HBase operations (like exports and imports) depend on YARN jobs.</p>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="resourcemanager-crashes">ResourceManager Crashes<a href="#resourcemanager-crashes" class="hash-link" aria-label="Direct link to ResourceManager Crashes" title="Direct link to ResourceManager Crashes">​</a></h3>
<p><strong>Description</strong></p>
<p>The YARN ResourceManager may crash or become unresponsive due to Java heap exhaustion, excessive garbage collection, queue/scheduler misconfiguration, application overload, or issues in application history management. This is a critical failure that impacts the entire cluster, as no new jobs can be submitted or scheduled while the ResourceManager is down.</p>
<p><strong>Symptoms</strong></p>
<ul>
<li>New jobs are not accepted or scheduled; running jobs may be orphaned</li>
<li>YARN ResourceManager UI is unavailable or returns HTTP 500 errors</li>
<li>Frequent ResourceManager restarts (you can easily spot this by checking the YARN application ID)</li>
<li>“OutOfMemoryError”, “Unable to create new native thread”, or similar exceptions in ResourceManager logs</li>
<li>UI or CLI operations hang or timeout</li>
</ul>
<p><strong>Investigation</strong></p>
<ul>
<li><strong>Review ResourceManager Logs</strong> Look for memory-related errors, thread exhaustion, and application history loading issues.</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">less /var/log/hadoop-yarn/hadoop-yarn-resourcemanager-*.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">grep -i &quot;OutOfMemoryError&quot; /var/log/hadoop-yarn/hadoop-yarn-resourcemanager-*.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">grep -i &quot;Unable to create new native thread&quot; /var/log/hadoop-yarn/hadoop-yarn-resourcemanager-*.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">grep -i &quot;Exception&quot; /var/log/hadoop-yarn/hadoop-yarn-resourcemanager-*.log</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><strong>Monitor ResourceManager Heap Usage</strong> Check for memory pressure or GC issues on the ResourceManager node:</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rm_pid=`sudo jps -v | grep ResourceManager | awk -F&#x27; &#x27; &#x27;{print $1}&#x27;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo jstat -gcutil $rm_pid 5s 10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">top -p $rm_pid</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><strong>Check Number of Applications Managed</strong> A high count of completed or running applications can overload the scheduler and history components.</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">yarn application -list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yarn application -list -appStates ALL | wc -l</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Resolution</strong></p>
<ul>
<li><strong>Increase ResourceManager Java Heap Size</strong> Edit yarn-env.sh to allocate more memory: <code>export YARN_RESOURCEMANAGER_HEAPSIZE=4096</code> or use EMR classifications:</li>
</ul>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Classification&quot;: &quot;yarn-env&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Configurations&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;Classification&quot;: &quot;export&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;Properties&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;YARN_RESOURCEMANAGER_HEAPSIZE&quot;: &quot;4096&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Properties&quot;: {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><strong>Reduce Completed Application Retention</strong> Set a lower value for completed application retention to prevent RM overload: Set <code>yarn.resourcemanager.max-completed-applications</code> in yarn-site.xml or use EMR Classifications:</li>
</ul>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Classification&quot;: &quot;yarn-site&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Properties&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;yarn.resourcemanager.max-completed-applications&quot;: &quot;500&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><strong>Restart ResourceManager</strong> After making configuration changes (manually), restart the ResourceManager:</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl restart hadoop-yarn-resourcemanager</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Prevention</strong></p>
<ul>
<li>
<p><strong>Set Reasonable Completed Application Limits</strong> Ensure <code>yarn.resourcemanager.max-completed-applications</code> is not set excessively high on small EMR Master nodes. (default: 1000)</p>
</li>
<li>
<p><strong>Enable ResourceManager High Availability</strong> (using <a href="https://docs.aws.amazon.com/emr/latest/ManagementGuide/emr-plan-ha-launch.html" target="_blank" rel="noopener noreferrer">EMR Multi Master</a>) for production clusters, to minimize downtime.</p>
</li>
<li>
<p><strong>Monitor ResourceManager Health</strong> Set up alerts for high heap utilization, long GC times, and repeated restarts.</p>
</li>
</ul>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="yarn-containers-out-of-memory-errors">YARN Containers Out of Memory Errors<a href="#yarn-containers-out-of-memory-errors" class="hash-link" aria-label="Direct link to YARN Containers Out of Memory Errors" title="Direct link to YARN Containers Out of Memory Errors">​</a></h3>
<p><strong>Description</strong></p>
<p>Jobs may fail if the memory allocated to YARN containers is insufficient for the workload’s requirements. This issue is frequently encountered in distributed processing frameworks such as Spark, Hive (Tez), and MapReduce. When a container exceeds its assigned memory limit, YARN will kill the container, leading to job failures or repeated task retries.</p>
<p><strong>Symptoms</strong></p>
<ul>
<li>Containers killed with messages like: <code>Container [pid=xxxx,containerID=container_xxx] is running beyond physical memory limits</code></li>
<li><code>OutOfMemoryError</code> exceptions in application or container logs</li>
<li>Job fails with <code>killed by YARN for exceeding memory limits</code> in the ResourceManager or JobHistory UI</li>
<li>Tasks restart repeatedly or job fails after several retries due to OOM</li>
<li>Slow performance or “stuck” jobs before crashing</li>
</ul>
<p><strong>Investigation</strong>:</p>
<ul>
<li><strong>Review Container and Application Logs</strong> Look for OOM messages and stack traces:</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">yarn logs -applicationId &lt;APP_ID&gt; | grep -i &quot;OutOfMemoryError&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yarn logs -applicationId &lt;APP_ID&gt; | grep -i &quot;memory&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><strong>ResourceManager and NodeManager Logs</strong> Check for container kill events and memory limit violations:</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">less /var/log/hadoop-yarn/hadoop-yarn-resourcemanager-*.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">less /var/log/hadoop-yarn/hadoop-yarn-nodemanager-*.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">grep -i &quot;exceeded virtual memory&quot; /var/log/hadoop-yarn/yarn-yarn-nodemanager-*.log</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>
<p><strong>Application UIs</strong></p>
<ul>
<li>Spark UI: Review executor and driver memory usage under the “Executors” tab and check for task failures.</li>
<li>Job History Server (MapReduce): Look for killed tasks and memory-related errors.</li>
</ul>
</li>
<li>
<p><strong>Cluster Metrics and Monitoring</strong> Use cluster monitoring dashboards to spot memory pressure, container failures, or node hotspots.</p>
</li>
</ul>
<p><strong>Resolution</strong></p>
<ul>
<li>
<p><strong>Increase Container Memory Allocation</strong> Adjust memory settings based on application type:</p>
<ul>
<li>
<p><strong>Spark</strong></p>
<ul>
<li>Increase executor memory: <code>--executor-memory 4G</code></li>
<li>Increase driver memory (if driver fails): <code>--driver-memory 2G</code></li>
</ul>
</li>
<li>
<p><strong>MapReduce</strong></p>
<ul>
<li>Set map/reduce memory: <code>mapreduce.map.memory.mb</code> and <code>mapreduce.reduce.memory.mb</code></li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Optimize Application Memory Usage</strong></p>
<ul>
<li>Review code for memory leaks, inefficiencies and large in-memory objects.</li>
</ul>
</li>
<li>
<p><strong>Tune YARN ResourceManager Settings</strong></p>
<ul>
<li>Check that worker nodes have enough RAM to handle the requested container sizes.</li>
<li>Ensure YARN allows for higher per-container allocations if required by your application:</li>
<li><code>yarn.scheduler.maximum-allocation-mb</code></li>
<li><code>yarn.nodemanager.resource.memory-mb</code></li>
</ul>
</li>
</ul>
<p><strong>Prevention</strong></p>
<ul>
<li><strong>Test on Smaller Datasets</strong> Run jobs at scale on test data to tune resource requirements before production.</li>
<li><strong>Monitor Regularly</strong> Set up alerts on high memory usage, container failures, and node health to catch issues early.</li>
</ul>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="yarn-containers-failures">YARN Containers Failures<a href="#yarn-containers-failures" class="hash-link" aria-label="Direct link to YARN Containers Failures" title="Direct link to YARN Containers Failures">​</a></h3>
<p><strong>Description</strong></p>
<p>YARN containers may fail to start or crash during execution due to a range of causes, including resource exhaustion, missing dependencies, configuration errors, or issues in the user’s code. External service problems, such as S3 throttling, can also cause tasks to fail or hang, especially when submitting HBase inport / export commands to restore HBase snapshots from an Amazon S3 bucket.</p>
<p><strong>Symptoms</strong></p>
<ul>
<li>Containers exit with a non-zero exit code (e.g., Container exited with exitCode: 1)</li>
<li>Application marked as failed in YARN ResourceManager UI</li>
<li>Error messages like Failed to launch container or Container killed by the ApplicationMaster</li>
<li>Amazon S3 related errors in containers logs, e.g., <code>503 Slow Down</code>, <code>503 Service Unavailable</code></li>
</ul>
<p><strong>Investigation</strong></p>
<ul>
<li><strong>View YARN Application and Container Logs</strong> Get the logs for a specific YARN application:</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">yarn logs -applicationId &lt;YARN_APP_ID&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Or view individual container logs only:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">yarn logs -applicationId &lt;YARN_APP_ID&gt; -containerId &lt;CONTAINER_ID&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><strong>Check YARN ResourceManager and NodeManager Logs</strong> Look for resource allocation errors or container launch failures:</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># YARN RM on EMR MASTER</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">less /var/log/hadoop-yarn/hadoop-yarn-resourcemanager-*.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># YARN NM on EMR CORE and TASK nodes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">less /var/log/hadoop-yarn/hadoop-yarn-nodemanager-*.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">grep -i &quot;Failed to launch container&quot; /var/log/hadoop-yarn/hadoop-yarn-nodemanager-*.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">grep -i &quot;exitCode&quot; /var/log/hadoop-yarn/hadoop-yarn-nodemanager-*.log</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><strong>Identify S3 Throttling</strong></li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">yarn logs -applicationId &lt;YARN_APP_ID&gt; | grep -i &quot;SlowDown&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yarn logs -applicationId &lt;YARN_APP_ID&gt; | grep -i &quot;503&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><strong>Check Cluster Resource Utilization</strong> Use <code>yarn top</code>, or cluster monitoring tools to look for resource pressure.</li>
</ul>
<p><strong>Resolution</strong></p>
<ul>
<li>
<p><strong>Fix Application Errors</strong> Review stack traces and error messages in container logs. Correct code issues, missing libraries, or input data problems.</p>
</li>
<li>
<p><strong>Resolve S3 Throttling</strong></p>
<ul>
<li>Review if the bucket is consistently used by mulitple applications that might end up exacerbating throttled requests.</li>
<li>Implement or tune <a href="https://docs.aws.amazon.com/emr/latest/ReleaseGuide/emr-spark-emrfs-retry.html" target="_blank" rel="noopener noreferrer">EMRFS Retry Requests</a></li>
<li>Contact AWS Support if you observe persistent throttling (look for SlowDown and 503 in logs).</li>
</ul>
</li>
</ul>
<p><strong>Prevention</strong></p>
<ul>
<li><strong>Test Applications in Lower Environments</strong> Validate code and resource settings on a development or staging cluster before running in production.</li>
<li><strong>Use Container Isolation and Resource Monitoring</strong> Enable resource isolation (cgroups, YARN container memory/vcore limits) and monitor usage to proactively detect hot spots.</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="troubleshooting-commands">Troubleshooting Commands<a href="#troubleshooting-commands" class="hash-link" aria-label="Direct link to Troubleshooting Commands" title="Direct link to Troubleshooting Commands">​</a></h2>
<p>This section provides a focused set of commands for collecting system-level diagnostics from a Linux host. These tools are essential for investigating complex issues such as high latency, memory leaks, GC pauses, thread contention, or network bottlenecks. By capturing Java thread dumps, heap dumps, and network traffic, along with relevant system metrics, you gain deeper visibility into HBase process behavior and resource usage.</p>
<p>Use these commands proactively during incident analysis or performance degradation to gather data for deeper inspection or escalation.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="java-thread-dump">Java Thread Dump<a href="#java-thread-dump" class="hash-link" aria-label="Direct link to Java Thread Dump" title="Direct link to Java Thread Dump">​</a></h3>
<p>To capture the current state of all threads in a Java process. Useful for diagnosing deadlocks, thread contention, or long GC pauses.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Find the Java PID (e.g., for HBase RegionServer or Master)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jps -l</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Set the PID to analyze and retrieve the user owning the process</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PID=&lt;pid&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PID_USER=`ps -o uname= -p &quot;${PID}&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Dump threads to stdout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo -u $PID_USER jstack $PID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Save to file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo -u $PID_USER jstack $PID &gt; /tmp/thread_dump_${PID}.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="java-heap-dump">Java Heap Dump<a href="#java-heap-dump" class="hash-link" aria-label="Direct link to Java Heap Dump" title="Direct link to Java Heap Dump">​</a></h3>
<p>To capture the entire Java heap for offline analysis of memory leaks or excessive object retention.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Find the Java PID (e.g., for HBase RegionServer or Master)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jps -l</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Set the PID to analyze and retrieve the user owning the process</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PID=&lt;pid&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PID_USER=`ps -o uname= -p &quot;${PID}&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Use jmap to generate heap dump</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo -u $PID_USER jmap -dump:format=b,file=/tmp/heap_dump_${PID}.hprof ${PID}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="collect-network-traffic">Collect Network Traffic<a href="#collect-network-traffic" class="hash-link" aria-label="Direct link to Collect Network Traffic" title="Direct link to Collect Network Traffic">​</a></h3>
<p>To analyze network-level issues like slow client connections, RPC delays, DNS failures, etc.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Use tcpdump to capture all traffic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo tcpdump -s 0 -w /tmp/network_traffic.pcap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Limit to HBase ports (e.g., 16000 for master, 16020 for regionserver)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo tcpdump port 16020 -w /tmp/rs_traffic.pcap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Capture DNS traffic (common issue)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo tcpdump port 53 -w /tmp/dns_traffic.pcap</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="disk--filesystem">Disk &amp; Filesystem<a href="#disk--filesystem" class="hash-link" aria-label="Direct link to Disk &amp; Filesystem" title="Direct link to Disk &amp; Filesystem">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Check available disk space</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df -h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Inode usage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df -i</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># List largest files (to debug disk full issues)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">du -sh /* 2&gt;/dev/null | sort -hr | head -n 20</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="memory--cpu">Memory &amp; CPU<a href="#memory--cpu" class="hash-link" aria-label="Direct link to Memory &amp; CPU" title="Direct link to Memory &amp; CPU">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Real-time system resource usage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">top</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Memory summary</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">free -h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Process-specific memory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ps -p &lt;pid&gt; -o pid,vsz,rss,cmd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Detailed CPU usage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mpstat -P ALL 1 5</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="open-files-and-file-descriptors">Open Files and File Descriptors<a href="#open-files-and-file-descriptors" class="hash-link" aria-label="Direct link to Open Files and File Descriptors" title="Direct link to Open Files and File Descriptors">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Count open files by process</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ls /proc/&lt;pid&gt;/fd | wc -l</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># List open descriptors (files, connections, etc)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lsof -p &lt;pid&gt; | head</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Check system-wide limits</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ulimit -a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat /proc/sys/fs/file-max</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="networking">Networking<a href="#networking" class="hash-link" aria-label="Direct link to Networking" title="Direct link to Networking">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Established connections</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ss -tulnp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Connections by port</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">netstat -anp | grep 16000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># DNS resolution times (useful when using Custom DNS)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dig hbase-regionserver.example.com +stats</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="io-wait--performance">I/O Wait &amp; Performance<a href="#io-wait--performance" class="hash-link" aria-label="Direct link to I/O Wait &amp; Performance" title="Direct link to I/O Wait &amp; Performance">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># I/O stats by device</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iostat -xz 1 5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Disk read/write stats</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vmstat 1 5</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/bestpractices/Applications/HBase/troubleshooting.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/aws-emr-best-practices/docs/bestpractices/Applications/HBase/security"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Security</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/aws-emr-best-practices/docs/bestpractices/Applications/Hadoop/introduction"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Overview</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#hbase-issues" class="table-of-contents__link toc-highlight">HBase Issues</a><ul><li><a href="#important-notes" class="table-of-contents__link toc-highlight">Important Notes</a></li><li><a href="#hbase-master-not-starting" class="table-of-contents__link toc-highlight">HBase Master Not Starting</a></li><li><a href="#hbase-regionserver-crashes" class="table-of-contents__link toc-highlight">HBase RegionServer Crashes</a></li><li><a href="#slow-reads-or-writes" class="table-of-contents__link toc-highlight">Slow Reads or Writes</a></li><li><a href="#table-inconsistencies" class="table-of-contents__link toc-highlight">Table Inconsistencies</a></li></ul></li><li><a href="#hadoop-hdfs-issues" class="table-of-contents__link toc-highlight">Hadoop HDFS Issues</a><ul><li><a href="#namenode-high-memorycpu-usage" class="table-of-contents__link toc-highlight">NameNode High Memory/CPU Usage</a></li><li><a href="#hdfs-under-replication" class="table-of-contents__link toc-highlight">HDFS Under-Replication</a></li><li><a href="#hdfs-block-corruption" class="table-of-contents__link toc-highlight">HDFS Block Corruption</a></li></ul></li><li><a href="#hadoop-yarn-issues" class="table-of-contents__link toc-highlight">Hadoop YARN Issues</a><ul><li><a href="#resourcemanager-crashes" class="table-of-contents__link toc-highlight">ResourceManager Crashes</a></li><li><a href="#yarn-containers-out-of-memory-errors" class="table-of-contents__link toc-highlight">YARN Containers Out of Memory Errors</a></li><li><a href="#yarn-containers-failures" class="table-of-contents__link toc-highlight">YARN Containers Failures</a></li></ul></li><li><a href="#troubleshooting-commands" class="table-of-contents__link toc-highlight">Troubleshooting Commands</a><ul><li><a href="#java-thread-dump" class="table-of-contents__link toc-highlight">Java Thread Dump</a></li><li><a href="#java-heap-dump" class="table-of-contents__link toc-highlight">Java Heap Dump</a></li><li><a href="#collect-network-traffic" class="table-of-contents__link toc-highlight">Collect Network Traffic</a></li><li><a href="#disk--filesystem" class="table-of-contents__link toc-highlight">Disk &amp; Filesystem</a></li><li><a href="#memory--cpu" class="table-of-contents__link toc-highlight">Memory &amp; CPU</a></li><li><a href="#open-files-and-file-descriptors" class="table-of-contents__link toc-highlight">Open Files and File Descriptors</a></li><li><a href="#networking" class="table-of-contents__link toc-highlight">Networking</a></li><li><a href="#io-wait--performance" class="table-of-contents__link toc-highlight">I/O Wait &amp; Performance</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Contributing</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/aws/aws-emr-best-practices/tree/main" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Built with ❤️ at AWS  <br> © 2025 Amazon.com, Inc. or its affiliates. All Rights Reserved</div></div></div></footer></div>
</body>
</html>