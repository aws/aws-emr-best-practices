"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[6663],{2835:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>t,default:()=>p,frontMatter:()=>o,metadata:()=>i,toc:()=>l});var a=r(5893),s=r(1151);const o={},t="YARN Docker with GPU",i={id:"bestpractices/Applications/Hadoop/yarn_docker_gpu",title:"YARN Docker with GPU",description:"Overview",source:"@site/docs/bestpractices/5 - Applications/Hadoop/yarn_docker_gpu.md",sourceDirName:"bestpractices/5 - Applications/Hadoop",slug:"/bestpractices/Applications/Hadoop/yarn_docker_gpu",permalink:"/aws-emr-best-practices/docs/bestpractices/Applications/Hadoop/yarn_docker_gpu",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/bestpractices/5 - Applications/Hadoop/yarn_docker_gpu.md",tags:[],version:"current",frontMatter:{},sidebar:"bestpractices",previous:{title:"Introduction",permalink:"/aws-emr-best-practices/docs/bestpractices/Applications/Hadoop/introduction"},next:{title:"YARN Scaling with custom labels",permalink:"/aws-emr-best-practices/docs/bestpractices/Applications/Hadoop/yarn_labels_scaling"}},c={},l=[{value:"Overview",id:"overview",level:2},{value:"Configurations",id:"configurations",level:2},{value:"Examples",id:"examples",level:2},{value:"Resources",id:"resources",level:2},{value:"References",id:"references",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,s.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h1,{id:"yarn-docker-with-gpu",children:"YARN Docker with GPU"}),"\n",(0,a.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,a.jsx)(n.p,{children:"This document provides a guide on launching an Amazon EMR cluster to execute YARN applications utilizing GPU resources within Docker containers."}),"\n",(0,a.jsx)(n.p,{children:"While EMR inherently installs all necessary NVIDIA drivers and libraries to run GPU-accelerated tasks, additional configurations and software are required to extend this capability to YARN applications running in docker containers."}),"\n",(0,a.jsx)(n.p,{children:"To enable GPU utilization within Docker containers, the following steps are required while launching an EMR cluster:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["Attach an ",(0,a.jsx)(n.a,{href:"https://docs.aws.amazon.com/emr/latest/ManagementGuide/emr-plan-bootstrap.html",children:"EMR Bootstrap Action"})," to prepare the cluster nodes. You can use the following script as an example ",(0,a.jsx)(n.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:r(7722).Z+"",children:"EMR 6.x - Bootstrap Action"})]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["Specify the following ",(0,a.jsx)(n.a,{href:"https://docs.aws.amazon.com/emr/latest/ReleaseGuide/emr-configure-apps.html",children:"EMR cluster configurations"})," while launching the cluster."]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"configurations",children:"Configurations"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'[\n  {\n    "Classification": "yarn-site",\n    "Properties": {\n      "yarn.nodemanager.container-executor.class": "org.apache.hadoop.yarn.server.nodemanager.LinuxContainerExecutor",\n      "yarn.nodemanager.linux-container-executor.cgroups.hierarchy": "yarn",\n      "yarn.nodemanager.linux-container-executor.cgroups.mount": "true",\n      "yarn.nodemanager.linux-container-executor.cgroups.mount-path": "/sys/fs/cgroup",\n      "yarn.nodemanager.resource-plugins": "yarn.io/gpu",\n      "yarn.nodemanager.resource-plugins.gpu.allowed-gpu-devices": "auto",\n      "yarn.nodemanager.resource-plugins.gpu.path-to-discovery-executables": "/usr/bin",\n      "yarn.resource-types": "yarn.io/gpu",\n      "yarn.nodemanager.resource-plugins.gpu.docker-plugin": "nvidia-docker-v2"\n    }\n  },\n  {\n    "Classification": "container-executor",\n    "Configurations": [\n      {\n        "Classification": "docker",\n        "Properties": {\n          "docker.allowed.runtimes": "nvidia",\n          "docker.trusted.registries": "library,centos"\n        }\n      },     \n      {\n        "Classification": "gpu",\n        "Properties": {\n          "module.enabled": "true"\n        }\n      },     \n      {\n        "Classification": "cgroups",\n        "Properties": {\n          "root": "/sys/fs/cgroup",\n          "yarn-hierarchy": "yarn"\n        }\n      }\n    ],\n    "Properties": {}\n  },\n  {\n    "Classification": "capacity-scheduler",\n    "Properties": {\n      "yarn.scheduler.capacity.resource-calculator": "org.apache.hadoop.yarn.util.resource.DominantResourceCalculator"\n    }\n  }\n]\n'})}),"\n",(0,a.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,a.jsx)(n.p,{children:"To validate the setup, you can connect to the EMR primary node and run the YARN Distributed Shell. The following command launch a YARN application using docker nvidia runtime."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"yarn jar /usr/lib/hadoop-yarn/hadoop-yarn-applications-distributedshell.jar \\\n  -jar /usr/lib/hadoop-yarn/hadoop-yarn-applications-distributedshell.jar \\\n  -shell_env YARN_CONTAINER_RUNTIME_TYPE=docker \\\n  -shell_env YARN_CONTAINER_RUNTIME_DOCKER_IMAGE=ubuntu \\\n  -shell_command nvidia-smi \\\n  -container_resources memory-mb=3072,vcores=1,yarn.io/gpu=1 \\\n  -num_containers 1\n"})}),"\n",(0,a.jsx)(n.h2,{id:"resources",children:"Resources"}),"\n",(0,a.jsx)(n.p,{children:"In this section, you'll find additional resources for testing this feature."}),"\n",(0,a.jsx)(n.p,{children:"To deploy the CloudFormation templates, store the relevant Bootstrap Action script in an S3 bucket. Next, launch the template from the AWS Web Console, ensuring to complete all necessary input parameters."}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["EMR 6.x - ",(0,a.jsx)(n.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:r(6062).Z+"",children:"CloudFormation Template"})," / ",(0,a.jsx)(n.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:r(7722).Z+"",children:"Bootstrap Action"})]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://hadoop.apache.org/docs/stable/hadoop-yarn/hadoop-yarn-site/UsingGpus.html",children:"Hadoop - Using GPU On YARN"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://docs.aws.amazon.com/emr/latest/ReleaseGuide/emr-spark-rapids.html",children:"EMR - Use the Nvidia RAPIDS Accelerator for Apache Spark"})}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},7722:(e,n,r)=>{r.d(n,{Z:()=>a});const a=r.p+"assets/files/emr-6-ba-yarn_docker_gpu-27483b80b326bb5650aac56db0271ccd.sh"},6062:(e,n,r)=>{r.d(n,{Z:()=>a});const a=r.p+"assets/files/emr-6-yarn_docker_gpu-53f54a0bfe3b373bcdacbceda38a0415.yaml"},1151:(e,n,r)=>{r.d(n,{Z:()=>i,a:()=>t});var a=r(7294);const s={},o=a.createContext(s);function t(e){const n=a.useContext(o);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),a.createElement(o.Provider,{value:n},e.children)}}}]);