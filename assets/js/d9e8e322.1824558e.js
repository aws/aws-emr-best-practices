"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[1281],{1735:(e,a,s)=>{s.r(a),s.d(a,{assets:()=>c,contentTitle:()=>r,default:()=>d,frontMatter:()=>o,metadata:()=>i,toc:()=>l});var t=s(4848),n=s(8453);const o={},r="Management",i={id:"bestpractices/Applications/HBase/management",title:"Management",description:"This section highlights some commands and best practices, that can help you to manage your HBase clusters on Amazon EMR.",source:"@site/docs/bestpractices/Applications/HBase/management.md",sourceDirName:"bestpractices/Applications/HBase",slug:"/bestpractices/Applications/HBase/management",permalink:"/aws-emr-best-practices/docs/bestpractices/Applications/HBase/management",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/bestpractices/Applications/HBase/management.md",tags:[],version:"current",frontMatter:{},sidebar:"bestpractices",previous:{title:"Data Migration",permalink:"/aws-emr-best-practices/docs/bestpractices/Applications/HBase/data_migration"},next:{title:"Observability",permalink:"/aws-emr-best-practices/docs/bestpractices/Applications/HBase/observability"}},c={},l=[{value:"Create command alias",id:"create-command-alias",level:2},{value:"Determine average row size",id:"determine-average-row-size",level:2},{value:"Reduce number of Regions",id:"reduce-number-of-regions",level:2}];function h(e){const a={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",p:"p",pre:"pre",strong:"strong",...(0,n.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(a.header,{children:(0,t.jsx)(a.h1,{id:"management",children:"Management"})}),"\n",(0,t.jsx)(a.p,{children:"This section highlights some commands and best practices, that can help you to manage your HBase clusters on Amazon EMR."}),"\n",(0,t.jsx)(a.h2,{id:"create-command-alias",children:"Create command alias"}),"\n",(0,t.jsx)(a.p,{children:"If you administrate your HBase cluster mainly from the shell of the EMR master, it might be convenient to define a command alias to avoid permission issues you might incur by typing erroneous commands using a different user (e.g. root)."}),"\n",(0,t.jsxs)(a.p,{children:["As best practice, you should always run HBase commands as ",(0,t.jsx)(a.code,{children:"hbase"})," user. In order to do that, you can add the following alias in the ",(0,t.jsx)(a.code,{children:"~/.bashrc"})," profile for the user that you use to administrate your cluster (e.g. hadoop)"]}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-bash",children:"alias hbase='sudo -u hbase hbase'\n"})}),"\n",(0,t.jsx)(a.p,{children:"Once done, you can safely run HBase commands as usual"}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-bash",children:"hbase shell\n"})}),"\n",(0,t.jsx)(a.h2,{id:"determine-average-row-size",children:"Determine average row size"}),"\n",(0,t.jsx)(a.p,{children:"If you want to determine the average size of a row stored in a HBase table, you can use the following commands to retrieve the payload from a storefile of the table. For example:"}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-bash",children:"# Simple notation\nhbase hfile -m -f $HBASE_PATH\n\n# Extended notation\nhbase org.apache.hadoop.hbase.io.hfile.HFile -m -f $HBASE_PATH\n"})}),"\n",(0,t.jsx)(a.p,{children:(0,t.jsx)(a.img,{alt:"Average Payload Size",src:s(2573).A+"",title:"Average Payload Size",width:"890",height:"242"})}),"\n",(0,t.jsxs)(a.p,{children:["The class ",(0,t.jsx)(a.code,{children:"org.apache.hadoop.hbase.io.hfile.HFile"})," allows you to analyze HBase store files that are persisted on HDFS or S3. The option ",(0,t.jsx)(a.code,{children:"-m"})," returns the metadata for the file analyzed that reports the average size (bytes) of the Row Key in that particular file, and the average size (bytes) of the values stored in that file."]}),"\n",(0,t.jsxs)(a.p,{children:["To get a rough estimation of the average payload of a single row, you can sum the parameters ",(0,t.jsx)(a.strong,{children:"avgKeyLen"})," and ",(0,t.jsx)(a.strong,{children:"avgValueLen"})," that are returned in the previous command, to get the average size in bytes of a row. For example:"]}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{children:"# row_avg_size = avgKeyLen + avgValueLen\nrow_avg_size = 19 + 7 = 26\n"})}),"\n",(0,t.jsxs)(a.p,{children:["This command might be useful to get a rough estimate of your data payload when you are not sure about it. You can later on use this value to fine-tuning your cluster (e.g. ",(0,t.jsx)(a.a,{href:"./best_practice#hbase-rpc-listeners",children:"increase/decrease RPC Listeners"}),")"]}),"\n",(0,t.jsx)(a.h2,{id:"reduce-number-of-regions",children:"Reduce number of Regions"}),"\n",(0,t.jsxs)(a.p,{children:["The HBase community introduced a new utility in the ",(0,t.jsx)(a.a,{href:"https://github.com/apache/hbase-operator-tools/blob/master/hbase-tools/",children:"hbase-tools"})," package that helps to reduce the number of regions for tables stored in HBase. This utility is available in the class ",(0,t.jsx)(a.code,{children:"org.apache.hbase.RegionsMerger"})," and can help you to automatically merge the number of regions to a value that you define, if you have a high count in your cluster (e.g. wrong table pre-split, or high split rate due to incorrect settings)"]}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-bash",children:"# copy library in classpath\nsudo cp /usr/lib/hbase-operator-tools/hbase-tools-*.jar /usr/lib/hbase/lib/\n\n# merge regions\nhbase org.apache.hbase.RegionsMerger <TABLE_NAME> <TARGET_NUMBER_OF_REGIONS>\n"})}),"\n",(0,t.jsx)(a.p,{children:"This tool is available in HBase versions >= 2.x.x and should only be used with these versions."})]})}function d(e={}){const{wrapper:a}={...(0,n.R)(),...e.components};return a?(0,t.jsx)(a,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},2573:(e,a,s)=>{s.d(a,{A:()=>t});const t=s.p+"assets/images/management_avg_payload-9dbea92df8686d59c1d6c669705ea0a3.png"},8453:(e,a,s)=>{s.d(a,{R:()=>r,x:()=>i});var t=s(6540);const n={},o=t.createContext(n);function r(e){const a=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(a):{...a,...e}}),[a,e])}function i(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:r(e.components),t.createElement(o.Provider,{value:a},e.children)}}}]);